<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>HAX603X: Modélisation stochastique - Méthode de Monte Carlo</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../Courses/marche_aleatoire.html" rel="next">
<link href="../Courses/loi_normale_multi.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Pas de résultats",
    "search-matching-documents-text": "documents trouvés",
    "search-copy-link-title": "Copier le lien vers la recherche",
    "search-hide-matches-text": "Cacher les correspondances additionnelles",
    "search-more-match-text": "correspondance de plus dans ce document",
    "search-more-matches-text": "correspondances de plus dans ce document",
    "search-clear-button-title": "Effacer",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Annuler",
    "search-submit-button-title": "Envoyer",
    "search-label": "Recherche"
  }
}</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../custom.css">
</head>

<body class="nav-sidebar floating nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">HAX603X</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Recherche"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Basculer la navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-cours" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Cours</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-cours">    
        <li>
    <a class="dropdown-item" href="../Courses/perspective_historique.html">
 <span class="dropdown-text">Perspectives historiques</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Courses/notations.html">
 <span class="dropdown-text">Notations et rappels</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Courses/th_asymptotique.html">
 <span class="dropdown-text">Théorèmes asymptotiques</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Courses/simulation.html">
 <span class="dropdown-text">Simulation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Courses/loi_normale1D.html">
 <span class="dropdown-text">Loi normale: cas univarié</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Courses/loi_normale_multi.html">
 <span class="dropdown-text">Loi normale: cas multivarié</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Courses/monte_carlo.html">
 <span class="dropdown-text">Méthode de Monte Carlo</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Courses/marche_aleatoire.html">
 <span class="dropdown-text">Marches aléatoires</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tp" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">TP</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-tp">    
        <li class="dropdown-header">TP</li>
        <li>
    <a class="dropdown-item" href="../TP/TP1.html">
 <span class="dropdown-text">TP1: Prise en main de Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../TP/TP2.html">
 <span class="dropdown-text">TP2: Simulation de lois élémentaires</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../TP/TP3.html">
 <span class="dropdown-text">TP3: Simulation de variables aléatoires</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Quarto</li>
        <li>
    <a class="dropdown-item" href="../TP/markdown.html">
 <span class="dropdown-text">Démarrage en Markdown</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../TP/quarto.html">
 <span class="dropdown-text">Démarrage en Quarto</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
    <a href="https://github.com/josephsalmon/HAX603X" title="GitHub" class="quarto-navigation-tool px-1" aria-label="GitHub"><i class="bi bi-github"></i></a>
    <a href="https://moodle.umontpellier.fr/course/view.php?id=25763" title="Moodle" class="quarto-navigation-tool px-1" aria-label="Moodle"><i class="bi bi-bicycle"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../Courses/monte_carlo.html">Méthode de Monte Carlo</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Courses/perspective_historique.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Perspectives historiques</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Courses/notations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notations et rappels</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Courses/th_asymptotique.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Théorèmes asymptotiques</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Courses/simulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simulation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Courses/loi_normale1D.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Loi normale: cas univarié</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Courses/loi_normale_multi.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Loi normale: cas multivarié</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Courses/monte_carlo.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Méthode de Monte Carlo</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Courses/marche_aleatoire.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Marches aléatoires</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Sur cette page</h2>
   
  <ul>
  <li><a href="#principe-de-la-méthode" id="toc-principe-de-la-méthode" class="nav-link active" data-scroll-target="#principe-de-la-méthode">Principe de la méthode</a></li>
  <li><a href="#théorèmes-de-convergence" id="toc-théorèmes-de-convergence" class="nav-link" data-scroll-target="#théorèmes-de-convergence">Théorèmes de convergence</a>
  <ul class="collapse">
  <li><a href="#convergence-de-la-méthode" id="toc-convergence-de-la-méthode" class="nav-link" data-scroll-target="#convergence-de-la-méthode">Convergence de la méthode</a></li>
  <li><a href="#précision-de-la-méthode" id="toc-précision-de-la-méthode" class="nav-link" data-scroll-target="#précision-de-la-méthode">Précision de la méthode</a></li>
  </ul></li>
  <li><a href="#réduction-de-variance" id="toc-réduction-de-variance" class="nav-link" data-scroll-target="#réduction-de-variance">Réduction de variance</a>
  <ul class="collapse">
  <li><a href="#variable-de-contrôle" id="toc-variable-de-contrôle" class="nav-link" data-scroll-target="#variable-de-contrôle">Variable de contrôle</a></li>
  <li><a href="#variables-antithétiques" id="toc-variables-antithétiques" class="nav-link" data-scroll-target="#variables-antithétiques">Variables antithétiques</a></li>
  <li><a href="#échantillonnage-préférentiel" id="toc-échantillonnage-préférentiel" class="nav-link" data-scroll-target="#échantillonnage-préférentiel">Échantillonnage préférentiel</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/josephsalmon/HAX603X/blob/main/Courses/monte_carlo.qmd" class="toc-action"><i class="bi bi-github"></i>Voir la source</a></li><li><a href="https://github.com/josephsalmon/HAX603X/issues/new" class="toc-action"><i class="bi empty"></i>Faire part d'un problème</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Méthode de Monte Carlo</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="hidden">
<p>{{ % variance % covariance }}</p>
</div>
<p>De manière générale, ce qu’on appelle une méthode de <strong>Monte-Carlo</strong><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> est une technique visant à calculer une quantité déterministe par le biais d’un procédé aléatoire. Une application très usuelle des méthodes Monte-Carlo est l’approximation numérique d’intégrales ou d’espérance, c’est ce que nous allons beaucoup développer dans ce chapitre.</p>
<div class="no-row-height column-margin column-container"><p><sup>1</sup>&nbsp;Le nom viendrait du <em>casino de Monte-Carlo</em> inspiré par la passion pour le jeu de l’oncle du physicien Stanislaw Ulam… Source <a href="https://en.wikipedia.org/wiki/Monte_Carlo_method">Wikipedia</a>.</p></div><p>Il existe également de nombreuses méthodes pour l’intégration numérique déterministe (méthodes des rectangles, trapèzes,…). Ces méthodes sont très rapides et efficaces en petite dimension, mais elles ne le sont plus du tout pour des dimensions plus grandes ou pour l’intégration de fonction peu régulières. Ainsi une intégration par Monte Carlo pour le cas de la grande dimension sera bien plus profitable.</p>
<section id="principe-de-la-méthode" class="level2">
<h2 class="anchored" data-anchor-id="principe-de-la-méthode">Principe de la méthode</h2>
<p><br></p>
<p>L’idée de la Méthode de Monte Carlo est d’exprimer l’intégrale qu’on cherche à approcher comme l’espérance d’une variable aléatoire, puis d’approcher cette espérance par une moyenne empirique. Si on veut calculer une intégrale de la forme <span class="math display">
    I=\int g(x)f(x)dx,
</span> on la réécrit comme <span class="math display">
    I=\mathbb E[g(X)],
</span> où <span class="math inline">X</span> est une variable aléatoire de densité <span class="math inline">f</span>. On suppose évidemment que <span class="math inline">g(X)</span> est bien intégrable, puis on approche l’espérance par la moyenne empirique <span class="math display">
    I_n=\frac{g(X_1)+g(X_2)+\cdots+g(X_n)}{n}.
</span> Il y a donc deux étapes : traduction sous forme d’espérance puis calcul de la moyenne empirique. Si l’expression à calculer est déjà sous forme d’espérance, il y a juste le calcul de la moyenne empirique à faire. Ce calcul se fait à partir de simulation de la variable aléatoire <span class="math inline">X</span> sous-jacente.</p>
<div id="exm-unif" class="theorem example">
<p><span class="theorem-title"><strong>Exemple 1</strong></span> On peut approcher l’intégrale</p>
<p><span class="math display">
    I=\int_0^1 g(x)dx \simeq  \sum_{i=0}^nw_ig(x_i),
</span> où les <span class="math inline">w_i</span> sont des nombres entre <span class="math inline">0</span> et <span class="math inline">1</span> dont la somme vaut <span class="math inline">1</span>, et les <span class="math inline">x_i</span> sont des points de l’intervalle <span class="math inline">[0,1]</span>. Par exemple, pour la méthode des trapèzes, on prend <span class="math inline">w_0=w_n=\frac{1}{2n}</span> et <span class="math inline">w_i=\frac 1 n</span> sinon et les <span class="math inline">x_i=\frac i  n</span> sont régulièrement répartis. Pour une méthode de Monte Carlo, on interprète l’intégrale comme <span class="math inline">\mathbb E[g(X)]</span> où <span class="math inline">X</span> est une variable aléatoire de loi uniforme sur <span class="math inline">[0,1]</span>. Alors les <span class="math inline">w_i</span> valent <span class="math inline">\frac{1}{n+1}</span> et les <span class="math inline">x_i</span> sont tirés selon la loi uniforme sur <span class="math inline">[0,1]</span>. Contrairement aux méthodes déterministes, la valeur de l’approximation change si on relance le calcul puisque les tirages sont aléatoires.</p>
</div>
<p>La méthode de Monte Carlo est très facile à programmer si on dispose d’un simulateur de la loi de <span class="math inline">X</span>, et n’impose aucune régularité sur <span class="math inline">g</span> à part de la mesurabilité.</p>
</section>
<section id="théorèmes-de-convergence" class="level2">
<h2 class="anchored" data-anchor-id="théorèmes-de-convergence">Théorèmes de convergence</h2>
<p>On s’intéresse maintenant à la convergence de cet algorithme : sous quelles conditions est-ce que <span class="math inline">I_n</span> converge vers <span class="math inline">I</span>, en quel sens, et à la vitesse de cette convergence : combien de tirages faut-il faire pour atteindre une précision souhaitée.</p>
<section id="convergence-de-la-méthode" class="level3">
<h3 class="anchored" data-anchor-id="convergence-de-la-méthode">Convergence de la méthode</h3>
<p>Commençons par énoncer des conditions sous lesquelles la méthode converge.</p>
<div id="prp-cvmc" class="theorem proposition">
<p><span class="theorem-title"><strong>Proposition 1</strong></span> Soit <span class="math inline">(X_n)_{n\in\N}</span> une suite de variables aléatoires indépendantes et de même loi que <span class="math inline">X</span>, et <span class="math inline">g</span> une fonction mesurable telle que <span class="math inline">g(X)</span> est intégrable. Alors la variable aléatoire <span class="math display">
    I_n=\frac{g(X_1)+g(X_2)+\cdots+g(X_n)}{n}
</span> converge presque presque sûrement vers <span class="math inline">I=\mathbb E[g(X)]</span> lorsque <span class="math inline">n</span> tend vers l’infini.</p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Preuve</em>. </span>Comme <span class="math inline">g(X)</span> est intégrable, et que les variables sont indépendantes et de même loi, il s’agit d’une application directe de la loi forte des grands nombres.</p>
</div>
<p>En particulier, si on sait simuler <span class="math inline">X</span>, on peut en faire des tirages <span class="math inline">X_1</span>, , <span class="math inline">X_n</span> et ainsi calculer <span class="math inline">I_n</span> qui est une valeur approchée de <span class="math inline">I</span> pour <span class="math inline">n</span> assez grand.</p>
<div id="exm-ex-p" class="theorem example">
<p><span class="theorem-title"><strong>Exemple 2</strong></span> Par exemple, si l’on répète un très grand nombre de fois <span class="math inline">n</span> une expérience aléatoire et que l’on s’intéresse à la réalisation de l’événement <span class="math inline">A</span> alors la loi des grands nombres nous garantit que : <span class="math display">
f_n(A)=\frac1n \times \hbox{ Nbre de fois où } A \hbox{ s'est réalisé} \xrightarrow[n \to \infty]{ps}\mathbb P(A).
</span> car <span class="math inline">f_n(A)=(1/n) \sum_{i=1}^n X_i</span> où <span class="math inline">X_i</span> est une v.a. de Bernoulli de paramètre <span class="math inline">p=\mathbb P(A)=\mathbb E[X]</span>. Autrement dit, la fréquence observée <span class="math inline">f_n(A)</span> de la réalisation de l’événement <span class="math inline">A</span> au cours d’un grand nombre de répétitions de l’expérience se rapproche de la probabilité <span class="math inline">P(A)</span>.</p>
</div>
<div id="exm-montyHall" class="theorem example">
<p><span class="theorem-title"><strong>Exemple 3 (Le jeu des trois portes ou paradoxe de Monty Hall)</strong></span> Un jeu télévisé se déroule face à trois portes identiques. On a placé une voiture derrière l’une des portes, et une chèvre derrière chacune des deux autres. Le candidat est placé devant les trois portes, il en choisit une au hasard et se place devant.</p>
<p>La présentatrice (qui sait où se trouve la voiture) ouvre alors l’une des deux autres portes, derrière laquelle il y a une chèvre, puis elle demande au candidat : “Voulez-vous modifier votre choix ?”</p>
<p>Le candidat a alors deux possibilités :</p>
<ol type="1">
<li>soit il ouvre la porte qu’il avait choisie en premier ; (il conserve son premier choix)</li>
<li>soit il ouvre une autre porte (celle qui n’a pas été ouverte par la présentatrice).</li>
</ol>
<p>Quelle est la meilleure stratégie pour le candidat ? Garder son premier choix ou changer de porte ?</p>
<p>Un raisonnement probabiliste peut fournir la solution. Mais vous pouvez vous aider en faisant des expériences pour faire une conjecture ! On peut par exemple lancer le programme ci-dessous en demandant de reproduire dix mille fois l’expérience (<span class="math inline">n= 10 000</span>).</p>
<div id="4108067e" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>portes <span class="op">=</span> np.array([<span class="st">"chevre"</span>, <span class="st">"chevre"</span>, <span class="st">"voiture"</span>])</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>NbSimulations <span class="op">=</span> <span class="dv">10000</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>gagne_avec_change <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>gagne_avec_conserve <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(NbSimulations):</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    porte_choisie <span class="op">=</span> np.random.choice(portes)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> porte_choisie <span class="op">==</span> <span class="st">"voiture"</span>:</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        gagne_avec_conserve <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>        gagne_avec_change <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Gagne en changeant : </span><span class="sc">{</span>gagne_avec_change <span class="op">/</span> NbSimulations <span class="op">*</span> <span class="dv">100</span><span class="sc">:.3f}</span><span class="ss"> %"</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Gagne sans changer : </span><span class="sc">{</span>gagne_avec_conserve <span class="op">/</span> NbSimulations <span class="op">*</span> <span class="dv">100</span><span class="sc">:.3f}</span><span class="ss"> %"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Gagne en changeant : 66.650 %
Gagne sans changer : 33.350 %</code></pre>
</div>
</div>
<p>On peut alors conjecturer que la probabilité de gagner en changeant de porte est égale à <span class="math inline">2/3</span> alors que si le candidat reste sur son premier choix la probabilité de gagner ne sera que de <span class="math inline">1/3</span>.</p>
</div>
</section>
<section id="précision-de-la-méthode" class="level3">
<h3 class="anchored" data-anchor-id="précision-de-la-méthode">Précision de la méthode</h3>
<p>On souhaiterait maintenant savoir quand on peut considérer que <span class="math inline">n</span> est assez grand pour que l’approximation soit satisfaisante.</p>
<div id="prp-tcl2" class="theorem proposition">
<p><span class="theorem-title"><strong>Proposition 2</strong></span> Si <span class="math inline">g(X)</span> est de carré intégrable, alors un intervalle de confiance asymptotique de niveau de confiance <span class="math inline">1-\alpha</span> pour l’intégrale <span class="math inline">I</span> est <span class="math display">
    \left(I_n-F^{-1}_{\mathcal{N}(0,1)}\big(\frac{\alpha}{2}\big)\sqrt{\frac{S_n^2}{n}}\leq I\leq I_n+F^{-1}_{\mathcal{N}(0,1)}\big(\frac{\alpha}{2}\big)\sqrt{\frac{S_n^2}{n}}\right),
</span> où <span class="math inline">F^{-1}_{\mathcal{N}(0,1)}</span> est la fonction quantile de la loi normale centrée réduite et <span class="math display">
    S_n^2=\frac{1}{n-1}\sum_{i=1}^n\big(g(X_i)-I_n\big)^2
</span> est l’estimateur sans biais de la variance empirique.</p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Preuve</em>. </span>Comme <span class="math inline">g(X)</span> est de carré intégrable, et que les <span class="math inline">X_i</span> sont iid, on peut appliquer le théorème central limite à la suite <span class="math inline">(g(X_i))</span>, ce qui donne <span class="math display">
    \frac{\frac{1}{n}\sum_{i=1}^n g(X_i)-\mathbb E[g(X)]}{\sqrt{\frac{\mathop{\mathrm{Var}}(g(X))}{n}}}\xrightarrow[n\to\infty]{\mathcal L}\mathcal N(0,1),
</span> ce qui se traduit dans notre contexte par <span class="math display">
    \frac{I_n-I}{\sqrt{\frac{\mathop{\mathrm{Var}}(g(X))}{n}}}\xrightarrow[n\to\infty]{\mathcal L}\mathcal N(0,1).
</span> En général, on ne connaît pas non plus <span class="math inline">\mathop{\mathrm{Var}}(g(X))</span>, donc on la remplace par un estimateur de la variance <span class="math inline">S_n^2=\frac{1}{n-1}\sum_{i=1}^n(g(X_i)-I_n)^2</span>. D’après la loi des grands nombres, cet estimateur converge ps, donc en probabilité (donc en loi) vers <span class="math inline">\mathop{\mathrm{Var}}(g(X))</span> qui est une constante. D’après le lemme de Slutsky, le couple <span class="math inline">(\frac{I_n-I}{\sqrt{n\mathop{\mathrm{Var}}(g(X))}},S^2_n)</span> converge en loi vers le couple <span class="math inline">(\mathcal N(0,1), \delta_{\mathop{\mathrm{Var}}(g(X))})</span>. En particulier, on a encore la convergence en loi du produit <span class="math display">
    \frac{I_n-I}{\sqrt{\frac{S^2_n}{n}}}=\frac{I_n-I}{\sqrt{\frac{\mathop{\mathrm{Var}}(g(X))}{n}}}\times \frac{\sqrt{\mathop{\mathrm{Var}}(g(X))}}{\sqrt{S^2_n}}\xrightarrow[n\to\infty]{\mathcal L}\mathcal N(0,1) \times 1.
</span> On peut en déduire facilement la construction de l’intervalle de confiance asymptotique de l’énoncé.</p>
</div>
<p>Ce résultat a deux conséquences importantes. D’une part, la vitesse de convergence est en <span class="math inline">n^{-1/2}</span>, ce qui est relativement lent, mais indépendant à la fois de la dimension de <span class="math inline">X</span> et de la régularité de <span class="math inline">g</span>. D’autre part, on peut calculer <span class="math inline">S_n^2</span> donc estimer l’erreur commise sans tirages aléatoires supplémentaires, avec le même échantillon qui sert pour estimer <span class="math inline">I</span>. <strong>Il est fortement recommandé de toujours faire une estimation de la précision en même temps que l’estimation Monte Carlo de l’espérance.</strong></p>
<div id="exm-actif" class="theorem example">
<p><span class="theorem-title"><strong>Exemple 4</strong></span> En finance, certains contrats (dont le coût est <span class="math inline">C&gt;0</span> et que l’on peut voir comme une assurance) permettent de vendre un actif acheté <span class="math inline">K&gt;0</span> à une date future <span class="math inline">N</span> fixée par le contrat s’il dépasse à ce moment là une certaine valeur cible <span class="math inline">K</span> également fixée dans le contrat. Si le prix de l’actif est plus bas que <span class="math inline">K</span>, on récupère tout de même sa mise <span class="math inline">K</span>. Considérons un modèle simplifié pour le cours de l’actif <span class="math inline">(S_n)_{n\geq 1}</span> : pour <span class="math inline">n\geq 1</span>, on pose <span class="math inline">S_n=\sum_{i=1}^nX_i</span> où les <span class="math inline">X_i</span> sont des variables aléatoires indépendantes de loi normale centrée réduite. Le gain moyen de la détentrice ou du détenteur du contrat décrit ci-dessus est donc <span class="math inline">\mathbb E[\max(S_N-K,0)]</span>. Le contrat n’est pas gratuit… Ainsi, l’enjeu est de comparer le coût <span class="math inline">C</span> et l’espérance <span class="math inline">\mathbb E[\max(S_N-K,0)]</span>.</p>
<p>Estimons cette quantité par la méthode de Monte Carlo.</p>
<div id="31d90714" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">100000</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="dv">60</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>K<span class="op">=</span> <span class="dv">1</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>I <span class="op">=</span> []</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> np.random.normal(<span class="dv">0</span>, <span class="dv">1</span>, N)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    S <span class="op">=</span> <span class="bu">max</span>(np.<span class="bu">sum</span>(X) <span class="op">-</span> K, <span class="dv">0</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    I.append(S)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>I <span class="op">=</span> np.array(I)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> np.mean(I)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> np.var(I)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"[</span><span class="sc">{</span>m <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> np<span class="sc">.</span>sqrt(s <span class="op">/</span> n)<span class="sc">:.3f}</span><span class="ss">, </span><span class="sc">{</span>m<span class="sc">:.3f}</span><span class="ss">, </span><span class="sc">{</span>m <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> np<span class="sc">.</span>sqrt(s <span class="op">/</span> n)<span class="sc">:.3f}</span><span class="ss">]"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[2.589, 2.615, 2.641]</code></pre>
</div>
</div>
</div>
</section>
</section>
<section id="réduction-de-variance" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="réduction-de-variance">Réduction de variance</h2>
<p>La proposition <a href="#prp-tcl2" class="quarto-xref">Proposition&nbsp;2</a> donne deux leviers pour augmenter la précision de l’estimation <span class="math inline">I_n</span> de <span class="math inline">I</span> :</p>
<ol type="1">
<li>augmenter le nombre <span class="math inline">n</span> de tirages,</li>
<li>diminuer la variance <span class="math inline">\mathop{\mathrm{Var}}(g(X))</span>.</li>
</ol>
<p>Si le premier levier est facilement praticable pour des cas simples, il n’est pas envisageable lorsque une simulation de <span class="math inline">g(X)</span> est coûteuse en temps de calcul ou lorsque la variance est très grande, ce qui arrive couramment. Nous allons examiner le deuxième levier dans cette partie, c’est ce qu’on appelle les <strong>méthodes de réduction de variance</strong>.</p>
<p>Regardons d’abord un exemple pour bien comprendre l’intérêt de ces méthodes.</p>
<div id="exm-ex-p2" class="theorem example">
<p><span class="theorem-title"><strong>Exemple 5</strong></span> Revenons sur l’exemple <a href="#exm-ex-p" class="quarto-xref">Exemple&nbsp;2</a> où on cherche à estimer <span class="math inline">p=\mathbb P(A)</span> à partir de tirages de loi de Bernoulli. Avec <span class="math inline">n</span> tirages, on a <span class="math inline">I_n\simeq p + \sqrt{\frac{p(1-p)}{n}}Z</span> avec <span class="math inline">Z</span> de loi normale centrée réduite. La valeur de <span class="math inline">p</span> est inconnue, mais on peut majorer <span class="math inline">p(1-p)</span> par <span class="math inline">1/4</span>. Si on veut faire une erreur de l’ordre <span class="math inline">0.01</span> sur <span class="math inline">p</span>, il convient de choisir <span class="math inline">n=\frac{1}{4\times 0.01^2}=0.25\cdot 10^{4}=2500</span>.</p>
<p>Si <span class="math inline">p</span> est proche de <span class="math inline">0.5</span>, une erreur de <span class="math inline">10^{-2}</span> peut être acceptable. Mais si on cherche à approcher une probabilité très petite, par exemple <span class="math inline">p=10^{-5}</span>, il faudra une précision d’au moins <span class="math inline">10^{-6}</span>, et donc prendre <span class="math inline">n=0.25\cdot 10^{12}</span> tirages. On voit bien apparaître les limites de la méthode directe, et l’intérêt de toujours calculer l’ordre de grandeur de l’erreur commise.</p>
</div>
<p>Il existe de nombreuses techniques de réduction de variance pour améliorer la vitesse de convergence. Malheureusement, aucune ne marche de façon automatique, il faut les choisir et les adapter au cas par cas. Il s’agit essentiellement d’exploiter d’une façon ou d’une autre l’idée que l’intégrale <span class="math inline">I</span> peut s’écrire de nombreuses façons différentes comme une espérance, et de choisir l’expression de variance minimale.</p>
<section id="variable-de-contrôle" class="level3">
<h3 class="anchored" data-anchor-id="variable-de-contrôle">Variable de contrôle</h3>
<p>Une première façon très simple de décomposer <span class="math inline">I</span> est la suivante <span class="math display">
    I=\mathbb{E}[g(X)]=\mathbb{E}[g(X)-h(X)]+\mathbb{E}[h(X)].
</span> Cette méthode est intéressante si on sait calculer explicitement <span class="math inline">\mathbb{E}[h(X)]</span> et si la variance diminue : <span class="math inline">\mathop{\mathrm{Var}}\big(g(X)-h(X)\big)&lt;\mathop{\mathrm{Var}}\big(g(X)\big)</span>. Idéalement, on voudrait que la variance de <span class="math inline">g(X)-h(X)</span> soit très petite. Or rappelons qu’une variable aléatoire est de variance nulle si et seulement si elle est constante. Pour mettre en oeuvre cette méthode, on va donc chercher une fonction <span class="math inline">h</span> qui soit une bonne approximation de <span class="math inline">g</span> sur l’intervalle d’intégration pour que la différence <span class="math inline">g-h</span> soit presque constante.</p>
<div id="exm-carre" class="theorem example">
<p><span class="theorem-title"><strong>Exemple 6</strong></span> Supposons que l’on veuille calculer <span class="math inline">I=\int_0^1 e^{x^2} dx \simeq 1.46265\dots</span> à l’aide de la loi uniforme sur <span class="math inline">[0,1]</span>. Comme au voisinage de <span class="math inline">0</span>, on a <span class="math inline">e^{x^2}\simeq 1+x^2</span>, on propose de prendre <span class="math inline">h(x)=1+x^2</span>. On a alors <span class="math display">
    \mathbb E[h(X)]=\int_0^11+x^2dx=\big[x+\frac{x^3}{3}\big]_0^1=\frac{4}{3}.
</span> On peut donc approcher <span class="math inline">I</span> par <span class="math display">
    I_n^{c}=\frac{1}{n}\sum_{i=1}^n\big(e^{X_i^2}-1-X_i^2\big)+\frac{4}{3},
</span> où les <span class="math inline">X_i</span> sont iid de loi uniforme sur <span class="math inline">[0,1]</span>. Regardons ce que ça donne numériquement.</p>
<div id="700088e2" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">10000</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> np.random.uniform(<span class="dv">0</span>, <span class="dv">1</span>, n)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Direct method</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>gX <span class="op">=</span> np.exp(X<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>m1 <span class="op">=</span> np.mean(gX)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>s1 <span class="op">=</span> np.var(gX)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Direct method confidence interval: [</span><span class="sc">{</span>m1 <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> np<span class="sc">.</span>sqrt(s1 <span class="op">/</span> n)<span class="sc">:.3f}</span><span class="ss">, </span><span class="sc">{</span>m1<span class="sc">:.3f}</span><span class="ss">, </span><span class="sc">{</span>m1 <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> np<span class="sc">.</span>sqrt(s1 <span class="op">/</span> n)<span class="sc">:.3f}</span><span class="ss">]"</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Variance </span><span class="sc">{</span>s1<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Direct method confidence interval: [1.451, 1.460, 1.469]
Variance 0.222</code></pre>
</div>
</div>
<div id="c90fffea" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Control variable</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>ghX <span class="op">=</span> np.exp(X<span class="op">**</span><span class="dv">2</span>) <span class="op">-</span> <span class="dv">1</span> <span class="op">-</span> X<span class="op">**</span><span class="dv">2</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>m2 <span class="op">=</span> np.mean(ghX) <span class="op">+</span> <span class="dv">4</span><span class="op">/</span><span class="dv">3</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>s2 <span class="op">=</span> np.var(ghX)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Control variable confidence interval: [</span><span class="sc">{</span>m2 <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> np<span class="sc">.</span>sqrt(s2 <span class="op">/</span> n)<span class="sc">:.3f}</span><span class="ss">, </span><span class="sc">{</span>m2<span class="sc">:.3f}</span><span class="ss">, </span><span class="sc">{</span>m2 <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> np<span class="sc">.</span>sqrt(s2 <span class="op">/</span> n)<span class="sc">:.3f}</span><span class="ss">]"</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Variance </span><span class="sc">{</span>s2<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Control variable confidence interval: [1.458, 1.461, 1.465]
Variance 0.033</code></pre>
</div>
</div>
<p>On constate que l’intervalle de confiance est plus étroit donc la précision meilleure avec la variable de contrôle. On a divisé la variance (empirique) par <span class="math inline">6.7</span>. Pour obtenir le même gain en augmentant le nombre de simulations, il aurait fallu <span class="math inline">6.7^2\simeq45</span> fois plus de simulations.</p>
</div>
</section>
<section id="variables-antithétiques" class="level3">
<h3 class="anchored" data-anchor-id="variables-antithétiques">Variables antithétiques</h3>
<p>S’il existe une fonction <span class="math inline">h</span> telle que <span class="math inline">X</span> et <span class="math inline">h(X)</span> ont la même loi, on peut écrire <span class="math inline">I</span> comme <span class="math display">
I=\mathbb{E}\left[\frac{g(X)+g(h(X))}{2}\right].
</span> On a en fait décomposé l’intégrale <span class="math inline">I</span> comme somme de deux espérance. Notons que ces deux intégrales font apparaître la même variable aléatoire, donc on peut estimer les deux espérances avec les <strong>mêmes tirages</strong>. En fait on a introduit une certaine forme de dépendance puisqu’on utilise <span class="math inline">g(X_i)</span> et <span class="math inline">g(h(X_i))</span> dans l’estimateur.</p>
<p>Examinons l’effet de cette décomposition sur la variance.</p>
<div id="lem-redvar" class="theorem lemma">
<p><span class="theorem-title"><strong>Lemme 1</strong></span> Supposons qu’il existe une fonction <span class="math inline">h</span> telle que <span class="math inline">X</span> et <span class="math inline">h(X)</span> ont la même loi de carré intégrable. Si <span class="math inline">\mathop{\mathrm{Cov}}(g(X),g(h(X))\leq 0</span> alors <span class="math display">
    \mathop{\mathrm{Var}}\left(\frac{g(X)+g(h(X))}{2}\right) \leq \frac{\mathop{\mathrm{Var}}(g(X))}{2},
</span></p>
<p>Autrement dit la méthode des variables antithétiques permet de réduire la variance au moins de moitié si <span class="math inline">g(X)</span> et <span class="math inline">g(h(X))</span> sont négativement corrélées.</p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Preuve</em>. </span>Calculons la variance <span class="math inline">V=\mathop{\mathrm{Var}}\big(g(X)+g(h(X))\big)</span>: <span class="math display">
\begin{align*}
  V &amp;= \mathop{\mathrm{Var}}\big(g(X)+g(h(X))\big)\\
    &amp;=\mathbb E[(g(X)-\mathbb E[g(X)]+g(h(X))-\mathbb E[g(h(X))])^2]\\
    &amp;= \mathbb E[(g(X)-\mathbb E[g(X)])^2]+\mathbb E[(g(h(X))-\mathbb E[g(h(X))])^2]\\
    &amp;\quad + 2\mathbb E[(g(X)-\mathbb E[g(X)])(g(h(X))-\mathbb E[g(h(X))])]\\
    &amp;= \mathop{\mathrm{Var}}(g(X))+\mathop{\mathrm{Var}}(g(h(X)) + 2 \mathop{\mathrm{Cov}}(g(X),g(h(X)).
\end{align*}
</span></p>
<p>En particulier, si <span class="math inline">\mathop{\mathrm{Cov}}(g(X),g(h(X))\leq 0</span>, on a <span class="math display">
\begin{align*}
    \mathop{\mathrm{Var}}\left(\frac{g(X)+g(h(X))}{2}\right)
    &amp; \leq \frac{ \mathop{\mathrm{Var}}(g(X))+\mathop{\mathrm{Var}}(g(h(X))}{4}\\
    &amp; =\frac{\mathop{\mathrm{Var}}(g(X))}{2},
\end{align*}
</span></p>
<p>car <span class="math inline">g(X)</span> et <span class="math inline">g(h(X))</span> ont la même loi donc la même variance. Dans le cas général, on a quand toujours <span class="math inline">2\mathop{\mathrm{Cov}}(g(X),g(h(X))\leq \mathop{\mathrm{Var}}(g(X))+\mathop{\mathrm{Var}}(g(h(X))</span> par l’inégalité de Cauchy-Schwartz, ce qui implique <span class="math display">
\begin{align*}
    \mathop{\mathrm{Var}}\left(\frac{g(X)+g(h(X))}{2}\right)
    &amp; \leq 2\frac{\mathop{\mathrm{Var}}(g(X))+\mathop{\mathrm{Var}}(g(h(X)))}{4}\\
    &amp; = \mathop{\mathrm{Var}}(g(X)),
\end{align*}
</span></p>
<p>donc même si on ne réduit pas effectivement la variance, on ne peut pas l’augmenter par cette méthode. On peut faire des calculs plus précis en faisant intervenir la covariance de <span class="math inline">g(X)</span> et <span class="math inline">g(h(X))</span> dans certains cas particuliers si on spécifie les lois.</p>
</div>
<p>Cette méthode est particulièrement simple à mettre en oeuvre pour les lois qui ont des propriétés de symétrie</p>
<div id="exm-carre2" class="theorem example">
<p><span class="theorem-title"><strong>Exemple 7</strong></span> Revenons sur l’exemple <a href="#exm-carre" class="quarto-xref">Exemple&nbsp;6</a> où on cherche à approcher <span class="math inline">I=\int_0^1 e^{x^2} dx</span> à l’aide de la loi uniforme sur <span class="math inline">[0,1]</span>. Cette loi a une propriété de symétrie : <span class="math inline">X</span> et <span class="math inline">1-X</span> ont la même loi. On a donc une approximation de <span class="math inline">I</span> de qualité identique ou meilleure en prenant <span class="math display">
    I_n^{a}=\frac{1}{2n}\sum_{i=1}^{n}\big(e^{X_i^2}+e^{(1-X_i)^2}\big).
</span></p>
<p>Regardons ce que cela donne numériquement.</p>
<div id="fb87eaef" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">10000</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> np.random.uniform(<span class="dv">0</span>, <span class="dv">1</span>, n)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Direct method</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>gX <span class="op">=</span> np.exp(X<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>m1 <span class="op">=</span> np.mean(gX)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>s1 <span class="op">=</span> np.var(gX)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Direct method confidence interval: [</span><span class="sc">{</span>m1 <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> np<span class="sc">.</span>sqrt(s1 <span class="op">/</span> n)<span class="sc">:.3f}</span><span class="ss">, </span><span class="sc">{</span>m1<span class="sc">:.3f}</span><span class="ss">, </span><span class="sc">{</span>m1 <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> np<span class="sc">.</span>sqrt(s1 <span class="op">/</span> n)<span class="sc">:.3f}</span><span class="ss">]"</span>)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Variance </span><span class="sc">{</span>s1<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Direct method confidence interval: [1.447, 1.456, 1.465]
Variance 0.220</code></pre>
</div>
</div>
<div id="59159f30" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Antithetic variable method</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>gaX <span class="op">=</span> (np.exp(X<span class="op">**</span><span class="dv">2</span>) <span class="op">+</span> np.exp((<span class="dv">1</span> <span class="op">-</span> X)<span class="op">**</span><span class="dv">2</span>)) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>m3 <span class="op">=</span> np.mean(gaX)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>s3 <span class="op">=</span> np.var(gaX)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Antithetic variable method confidence interval:, [</span><span class="sc">{</span>m3 <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> np<span class="sc">.</span>sqrt(s3 <span class="op">/</span> n)<span class="sc">:.3f}</span><span class="ss">, </span><span class="sc">{</span>m3<span class="sc">:.3f}</span><span class="ss">, </span><span class="sc">{</span>m3 <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> np<span class="sc">.</span>sqrt(s3 <span class="op">/</span> n)<span class="sc">:.3f}</span><span class="ss">]"</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Variance </span><span class="sc">{</span>s3<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Antithetic variable method confidence interval:, [1.458, 1.461, 1.464]
Variance 0.028</code></pre>
</div>
</div>
<p>On constate que l’intervalle de confiance est plus étroit donc la précision meilleure avec la variable antithétique. On a divisé la variance (empirique) par <span class="math inline">8</span>. Pour obtenir le même gain en augmentant le nombre de simulations, il aurait fallu <span class="math inline">8^2=64</span> fois plus de simulations.</p>
</div>
</section>
<section id="échantillonnage-préférentiel" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="échantillonnage-préférentiel">Échantillonnage préférentiel</h3>
<p>L’idée derrière l’échantillonnage préférentiel est similaire à celle des variables de contrôle. Cette fois-ci, au lieu de retrancher et d’ajouter une quantité, on va multiplier et diviser. L’interprétation en terme d’espérance est cependant complètement différente.</p>
<p>Supposons que l’on sache simuler une variable aléatoire <span class="math inline">Y</span> de densité <span class="math inline">h</span>. On peut alors écrire <span class="math inline">I</span> comme <span class="math display">
\begin{align*}
I&amp;=\mathbb E[g(X)]=\int g(x)f(x)dx
\\ &amp;= \int \frac{g(x)f(x)}{h(x)}h(x)dx=\mathbb{E}\left[ \frac{g(Y)f(Y)}{h(Y)}\right].
\end{align*}
</span></p>
<p>On a gagné quelque chose si <span class="math inline">\mathop{\mathrm{Var}}\Big(\frac{gf}{h}(Y)\Big)&lt;\mathop{\mathrm{Var}}\big(g(X)\big)</span>.</p>
<p>Comme pour la méthode de la variable de contrôle, on souhaite que la nouvelle variable <span class="math inline">\frac{g(Y)f(Y)}{h(Y)}</span> soit de variance aussi petite que possible, donc proche d’une constante. Si on prend <span class="math inline">h(x)=\frac{g(x)f(x)}{\mathbb E[g(X)]}</span> (qui est bien une densité si <span class="math inline">g</span> est positive), alors la variance de <span class="math inline">\frac{g(Y)f(Y)}{h(Y)}</span> est nulle. Évidemment, ce résultat n’est pas utilisable en pratique puisqu’on cherche justement à calculer <span class="math inline">\mathbb E[g(X)]</span>. Cependant, il guide la recherche d’une bonne fonction <span class="math inline">h</span> vers une approximation de <span class="math inline">|gf|</span> normalisée pour obtenir une densité.</p>
<div id="exm-loiUnif" class="theorem example page-columns page-full">
<p><span class="theorem-title"><strong>Exemple 8</strong></span> Revenons une fois de plus sur l’exemple <a href="#exm-carre" class="quarto-xref">Exemple&nbsp;6</a> où on cherche à approcher <span class="math inline">I=\int_0^1 e^{x^2} dx</span> à l’aide de la loi uniforme sur <span class="math inline">[0,1]</span>. On a donc <span class="math inline">f(x)=1</span> sur l’intervalle d’intégration, on cherche donc à nouveau une approximation de <span class="math inline">g(x)=e^{x^2}</span>. Utilisons encore l’approximation <span class="math inline">g(x)\simeq 1+x^2</span>, ce qui nous conne comme densité candidate <span class="math inline">h(x)=\frac{3}{4}(1+x^2)</span>. Regardons si on peut facilement simuler cette densité. Calculons sa fonction de répartition (sur <span class="math inline">[0,1]</span>) <span class="math display">
    F(t)=\int_0^t \frac{3}{4}(1+x^2)=\frac{3}{4}\big[x+\frac{x^3}{3}\big]_0^1=\frac{3}{4}(t+\frac{t^3}{3}).
</span> Essayons de l’inverser <span class="math display">
    F(t)=u \Leftrightarrow u = \frac{4}{3}(t+\frac{t^3}{3}) \Leftrightarrow t^3+3t-4u=0
</span></p>
<p>On trouve alors par la <strong>méthode de Cardan</strong><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> <span class="math display">
    F(t)=u \Leftrightarrow t=(\sqrt{1+4u^2}+2u)^{1/3}-(\sqrt{1+4u^2}-2u)^{1/3}.
</span></p>
<div class="no-row-height column-margin column-container"><p><sup>2</sup>&nbsp;voir par exemple la page <a href="https://fr.wikiversity.org/wiki/%C3%89quation_du_troisi%C3%A8me_degr%C3%A9/M%C3%A9thode_de_Cardan"><em>Equation du troisième degré / Méthode de Cardan</em></a></p></div><p>Regardons ce que ça donne numériquement.</p>
<div id="3d556f4f" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">10000</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> np.random.uniform(<span class="dv">0</span>, <span class="dv">1</span>, n)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Direct method</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>gX <span class="op">=</span> np.exp(X<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>m1 <span class="op">=</span> np.mean(gX)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>s1 <span class="op">=</span> np.var(gX)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Direct method confidence interval: [</span><span class="sc">{</span>m1 <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> np<span class="sc">.</span>sqrt(s1 <span class="op">/</span> n)<span class="sc">:.3f}</span><span class="ss">, </span><span class="sc">{</span>m1<span class="sc">:.3f}</span><span class="ss">, </span><span class="sc">{</span>m1 <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> np<span class="sc">.</span>sqrt(s1 <span class="op">/</span> n)<span class="sc">:.3f}</span><span class="ss">]"</span>)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Variance </span><span class="sc">{</span>s1<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Direct method confidence interval: [1.459, 1.468, 1.477]
Variance 0.228</code></pre>
</div>
</div>
<div id="86a12301" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Importance sampling</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> (<span class="dv">2</span><span class="op">*</span>X <span class="op">+</span> np.sqrt(<span class="dv">1</span> <span class="op">+</span> <span class="dv">4</span><span class="op">*</span>X<span class="op">**</span><span class="dv">2</span>))<span class="op">**</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">3</span>) <span class="op">-</span> (np.sqrt(<span class="dv">1</span> <span class="op">+</span> <span class="dv">4</span><span class="op">*</span>X<span class="op">**</span><span class="dv">2</span>) <span class="op">-</span> <span class="dv">2</span><span class="op">*</span>X)<span class="op">**</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">3</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>gpX <span class="op">=</span> np.exp(Y<span class="op">**</span><span class="dv">2</span>) <span class="op">/</span> (<span class="dv">3</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">+</span> Y<span class="op">**</span><span class="dv">2</span>) <span class="op">/</span> <span class="dv">4</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>m4 <span class="op">=</span> np.mean(gpX)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>s4 <span class="op">=</span> np.var(gpX)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Importance sampling confidence interval: [</span><span class="sc">{</span>m4 <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> np<span class="sc">.</span>sqrt(s4 <span class="op">/</span> n)<span class="sc">:.3f}</span><span class="ss">, </span><span class="sc">{</span>m4<span class="sc">:.3f}</span><span class="ss">, </span><span class="sc">{</span>m4 <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> np<span class="sc">.</span>sqrt(s4 <span class="op">/</span> n)<span class="sc">:.3f}</span><span class="ss">]"</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Variance </span><span class="sc">{</span>s4<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Importance sampling confidence interval: [1.461, 1.464, 1.467]
Variance 0.020</code></pre>
</div>
</div>
<p>On constate que l’intervalle de confiance est plus étroit donc la précision meilleure avec l’échantillonnage préférentiel. On a divisé la variance (empirique) par environ <span class="math inline">12</span>. Pour obtenir le même gain en augmentant le nombre de simulations, il aurait fallu <span class="math inline">12^2=144</span> fois plus de simulations.</p>
</div>
<p>Il existe bien d’autres méthodes de réduction de variance, comme par exemple la méthode de stratification très utilisée en théorie des sondages.</p>


</section>
</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Retour au sommet</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copié");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copié");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../Courses/loi_normale_multi.html" class="pagination-link  aria-label=" loi="" normale:="" cas="" multivarié"="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Loi normale: cas multivarié</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../Courses/marche_aleatoire.html" class="pagination-link" aria-label="Marches aléatoires">
        <span class="nav-page-text">Marches aléatoires</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/josephsalmon/HAX603X/blob/main/Courses/monte_carlo.qmd" class="toc-action"><i class="bi bi-github"></i>Voir la source</a></li><li><a href="https://github.com/josephsalmon/HAX603X/issues/new" class="toc-action"><i class="bi empty"></i>Faire part d'un problème</a></li></ul></div></div></div></footer></body></html>