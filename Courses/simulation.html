<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>HAX603X: Modélisation stochastique - Simulation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../Courses/loi_normale1D.html" rel="next">
<link href="../Courses/th_asymptotique.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Pas de résultats",
    "search-matching-documents-text": "documents trouvés",
    "search-copy-link-title": "Copier le lien vers la recherche",
    "search-hide-matches-text": "Cacher les correspondances additionnelles",
    "search-more-match-text": "correspondance de plus dans ce document",
    "search-more-matches-text": "correspondances de plus dans ce document",
    "search-clear-button-title": "Effacer",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Annuler",
    "search-submit-button-title": "Envoyer",
    "search-label": "Recherche"
  }
}</script>
<script type="module" src="../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../custom.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">HAX603X</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Recherche"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Basculer la navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-cours" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Cours</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-cours">    
        <li>
    <a class="dropdown-item" href="../Courses/perspective_historique.html">
 <span class="dropdown-text">Perspectives historiques</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Courses/notations.html">
 <span class="dropdown-text">Notations et rappels</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Courses/th_asymptotique.html">
 <span class="dropdown-text">Théorèmes asymptotiques</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Courses/simulation.html">
 <span class="dropdown-text">Simulation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Courses/loi_normale1D.html">
 <span class="dropdown-text">Loi normale: cas univarié</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Courses/loi_normale_multi.html">
 <span class="dropdown-text">Loi normale: cas multivarié</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Courses/monte_carlo.html">
 <span class="dropdown-text">Méthode de Monte Carlo</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Courses/marche_aleatoire.html">
 <span class="dropdown-text">Marches aléatoires</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-slides" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Slides</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-slides">    
        <li>
    <a class="dropdown-item" href="../Courses/slides.html">
 <span class="dropdown-text">Slides: menu principal</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Slides/slides_intro.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Slides/slides_notations_premiers_pas.html">
 <span class="dropdown-text">Notations et premiers pas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Slides/slides_th_asymptotique.html">
 <span class="dropdown-text">Théorèmes asymptotiques</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Slides/slides_simulation.html">
 <span class="dropdown-text">Simulation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Slides/slides_loi_normale1D.html">
 <span class="dropdown-text">Loi normale: cas univarié</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Slides/slides_loi_normale_multi.html">
 <span class="dropdown-text">Loi normale: cas multivarié</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tp" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">TP</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-tp">    
        <li class="dropdown-header">TP</li>
        <li>
    <a class="dropdown-item" href="../TP/TP1.html">
 <span class="dropdown-text">TP1: Prise en main de Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../TP/TP2.html">
 <span class="dropdown-text">TP2: Simulation de lois élémentaires</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../TP/TP3.html">
 <span class="dropdown-text">TP3: Simulation de variables aléatoires</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Quarto</li>
        <li>
    <a class="dropdown-item" href="../TP/markdown.html">
 <span class="dropdown-text">Démarrage en Markdown</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../TP/quarto.html">
 <span class="dropdown-text">Démarrage en Quarto</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-td" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">TD</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-td">    
        <li>
    <a class="dropdown-item" href="../TD/TD.html">
 <span class="dropdown-text">Travaux Dirigés (TD)</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
    <a href="https://github.com/josephsalmon/HAX603X" title="GitHub" class="quarto-navigation-tool px-1" aria-label="GitHub"><i class="bi bi-github"></i></a>
    <a href="https://moodle.umontpellier.fr/course/view.php?id=25763" title="Moodle" class="quarto-navigation-tool px-1" aria-label="Moodle"><i class="bi bi-bicycle"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../Courses/simulation.html">Simulation</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Courses/perspective_historique.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Perspectives historiques</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Courses/notations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notations et rappels</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Courses/th_asymptotique.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Théorèmes asymptotiques</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Courses/simulation.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Simulation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Courses/loi_normale1D.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Loi normale: cas univarié</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Courses/loi_normale_multi.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Loi normale: cas multivarié</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Courses/monte_carlo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Méthode de Monte Carlo</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Courses/marche_aleatoire.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Marches aléatoires</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Sur cette page</h2>
   
  <ul>
  <li><a href="#variables-aléatoires-uniformes" id="toc-variables-aléatoires-uniformes" class="nav-link active" data-scroll-target="#variables-aléatoires-uniformes">Variables aléatoires uniformes</a>
  <ul class="collapse">
  <li><a href="#générateur-congruentiel-linéaire" id="toc-générateur-congruentiel-linéaire" class="nav-link" data-scroll-target="#générateur-congruentiel-linéaire">Générateur congruentiel linéaire</a></li>
  <li><a href="#générateurs-alternatifs" id="toc-générateurs-alternatifs" class="nav-link" data-scroll-target="#générateurs-alternatifs">Générateurs alternatifs</a></li>
  <li><a href="#usage-en-numpy" id="toc-usage-en-numpy" class="nav-link" data-scroll-target="#usage-en-numpy">Usage en <code>numpy</code></a></li>
  <li><a href="#propriété-de-la-loi-uniforme" id="toc-propriété-de-la-loi-uniforme" class="nav-link" data-scroll-target="#propriété-de-la-loi-uniforme">Propriété de la loi uniforme</a></li>
  </ul></li>
  <li><a href="#méthode-dinversion" id="toc-méthode-dinversion" class="nav-link" data-scroll-target="#méthode-dinversion">Méthode d’inversion</a></li>
  <li><a href="#rappel-sur-la-fonction-quantile" id="toc-rappel-sur-la-fonction-quantile" class="nav-link" data-scroll-target="#rappel-sur-la-fonction-quantile">Rappel sur la fonction quantile</a></li>
  <li><a href="#méthode-dinversion-1" id="toc-méthode-dinversion-1" class="nav-link" data-scroll-target="#méthode-dinversion-1">Méthode d’inversion</a></li>
  <li><a href="#méthode-de-rejet" id="toc-méthode-de-rejet" class="nav-link" data-scroll-target="#méthode-de-rejet">Méthode de rejet</a>
  <ul class="collapse">
  <li><a href="#cas-mutlidimensionnel" id="toc-cas-mutlidimensionnel" class="nav-link" data-scroll-target="#cas-mutlidimensionnel">Cas mutlidimensionnel</a></li>
  </ul></li>
  <li><a href="#autres-méthodes" id="toc-autres-méthodes" class="nav-link" data-scroll-target="#autres-méthodes">Autres méthodes</a>
  <ul class="collapse">
  <li><a href="#sommation-de-variables-aléatoires" id="toc-sommation-de-variables-aléatoires" class="nav-link" data-scroll-target="#sommation-de-variables-aléatoires">Sommation de variables aléatoires</a></li>
  <li><a href="#loi-de-poisson" id="toc-loi-de-poisson" class="nav-link" data-scroll-target="#loi-de-poisson">Loi de Poisson</a></li>
  <li><a href="#bibliographie-et-pour-aller-plus-loin" id="toc-bibliographie-et-pour-aller-plus-loin" class="nav-link" data-scroll-target="#bibliographie-et-pour-aller-plus-loin">Bibliographie et pour aller plus loin</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/josephsalmon/HAX603X/blob/main/Courses/simulation.qmd" class="toc-action"><i class="bi bi-github"></i>Voir la source</a></li><li><a href="https://github.com/josephsalmon/HAX603X/issues/new" class="toc-action"><i class="bi empty"></i>Faire part d'un problème</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Simulation</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Dans ce chapitre on se demande comment simuler en pratique des variables aléatoires i.i.d. L’idée est de commencer par le cas de variables aléatoires de loi uniforme et d’en déduire les autres lois.</p>
<section id="variables-aléatoires-uniformes" class="level2">
<h2 class="anchored" data-anchor-id="variables-aléatoires-uniformes">Variables aléatoires uniformes</h2>
<p>On rappelle qu’une variable aléatoire <span class="math inline">U</span> suit une loi uniforme sur <span class="math inline">[0,1]</span>, noté <span class="math inline">\mathcal{U}([0,1])</span> si sa fonction de répartition <span class="math inline">F_U</span> est donnée par <span class="math display">
F_U(x)
=
\begin{cases}
    0, &amp; \text{si }x &lt; 0\,,        \\
    x, &amp; \text{si }x \in [0,1]\,,  \\
    1, &amp; \text{si }x &gt; 1\,.        \\
\end{cases}
</span></p>
<div>

</div>
<div id="cell-fig-repartition-uniforme" class="cell quarto-layout-panel" data-execution_count="4" data-layout-ncol="1">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-repartition-uniforme" class="cell-output cell-output-display quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-repartition-uniforme-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<pre id="fig-repartition-uniforme" class="cell-output cell-output-display"><code>Unable to display output for mime type(s): application/pdf</code></pre>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-repartition-uniforme-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Fonction de répartition de la loi uniforme
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<p>L’objectif est de simuler sur machine une suite <span class="math inline">U_1, \ldots, U_n</span> de variables aléatoires i.i.d. de loi <span class="math inline">\mathcal{U}([0,1])</span>. Plusieurs problèmes apparaissent alors :</p>
<ul>
<li>Une machine est déterministe.</li>
<li>Les nombres entre <span class="math inline">0</span> et <span class="math inline">1</span> donnés par la machine sont de la forme <span class="math inline">k/2^p</span>, pour <span class="math inline">k \in \{0, \ldots, 2^{p-1}\}</span>. On ne pourra donc jamais générer des nombres qui ne sont pas de cette forme.</li>
<li>Vérifier qu’une suite est bien i.i.d. est un problème difficile.</li>
</ul>
<div id="def-PRNG" class="theorem definition">
<p><span class="theorem-title"><strong>Définition 1 (Générateur de nombres pseudo-aléatoires)</strong></span> <br></p>
<p>Un <strong>générateur de nombres pseudo-aléatoires</strong> (<span class="emoji" data-emoji="gb">🇬🇧</span>: <em>Pseudo Random Number Generator</em>, PRNG), est un algorithme déterministe récursif qui renvoie une suite <span class="math inline">U_1, \ldots, U_n</span> dans <span class="math inline">[0,1]</span> qui a un “comportement similaire” à une suite i.i.d. de loi <span class="math inline">\mathcal{U}([0,1])</span>. Pour être plus rigoureux, ces nombres sont en fait des nombres entiers générés uniformément sur un certain interval. Dans un second temps, une transformation simple (normalisation) permet d’obtenir des nombres flottants (<span class="emoji" data-emoji="gb">🇬🇧</span>: <em>floats</em>) entre 0 et 1.</p>
</div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Pour aller plus loin
</div>
</div>
<div class="callout-body-container callout-body">
<p>Parfois il est utile d’aller chercher dans le code source certaines information pour savoir comment les fonctions sont codées dans les packages que l’on utiliser. Par exemple, pour <code>numpy</code> que l’on utilise fréquement, on peut voir l’opération choisie ici: <a href="https://github.com/numpy/numpy/blob/d50fc570a9e15ea4d8ec35add245d5d791fa4596/numpy/random/src/mt19937/randomkit.c#L479">Random: int -&gt; float en <code>numpy</code></a>.</p>
</div>
</div>
<p>Un tel algorithme se construit de la manière suivante :</p>
<ol type="1">
<li>On part d’une graine (<span class="emoji" data-emoji="gb">🇬🇧</span>: <em>seed</em>) <span class="math inline">U_0</span> qui détermine la première valeur de manière la plus arbitraire possible.</li>
<li>La procédure récursive s’écrit <span class="math inline">U_{n+1} = f(U_n)</span>, où <span class="math inline">f</span> est une transformation déterministe, de sorte que <span class="math inline">U_{n+1}</span> est le plus indépendant possible de <span class="math inline">U_1, \dots, U_n</span>.</li>
</ol>
<ul>
<li><p>La fonction <span class="math inline">f</span> est déterministe et prend ses valeurs dans un ensemble fini, donc l’algorithme est périodique. Le but est donc d’avoir la plus grande période possible.</p></li>
<li><p>Notons qu’une fois que la graine est fixée, alors l’algorithme donne toujours les mêmes valeurs. Fixer la graine peut donc être très utile pour répéter des simulations dans des conditions identiques et ainsi repérer des erreurs.</p></li>
</ul>
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercice: bug ou feature?
</div>
</div>
<div class="callout-body-container callout-body">
<p>Reprendre les widgets du chapitre <a href="../Courses/th_asymptotique.html">Théorèmes asymptotiques</a> et faites varier doucement le paramètre <span class="math inline">p</span> (de Bernoulli). Que constatez-vous? Proposer une explication potentielle.</p>
</div>
</div>
<section id="générateur-congruentiel-linéaire" class="level3">
<h3 class="anchored" data-anchor-id="générateur-congruentiel-linéaire">Générateur congruentiel linéaire</h3>
<p>La plupart des PRNG s’appuient sur des résultats arithmétiques. Un des plus connus est celui appelé Générateur congruentiel linéaire (<span class="emoji" data-emoji="gb">🇬🇧</span> Linear congruential generator, LCG). Il est défini comme suit: on construit récursivement une suite d’entiers <span class="math inline">X_i</span> via la congruence <span class="math display">
  X_{n+1} = a X_n + b \quad \text{mod } m \enspace,
</span> où <span class="math inline">a,b,m</span> sont des entiers bien choisis pour que la suite obtenue ait de bonnes propriétés. Il suffit alors de considérer <span class="math inline">X_n/m</span>. Par exemple, la fonction <code>rand</code> sur <code>scilab</code> utilise cette congruence avec <span class="math inline">m=2^{31}</span>, <span class="math inline">a=843\; 314\; 861</span>, et <span class="math inline">b=453\; 816\; 693</span>.</p>
</section>
<section id="générateurs-alternatifs" class="level3">
<h3 class="anchored" data-anchor-id="générateurs-alternatifs">Générateurs alternatifs</h3>
<p>Les langages <code>Python</code> et <code>R</code> utilisent par défaut le générateur Mersenne-Twister qui s’appuie sur la multiplication vectorielle, mais d’autres générateurs sont aussi disponibles. Ce générateur a pour période <span class="math inline">m =2^{19937}-1</span>, nombre qu’on peut raisonnablement considérer comme grand.</p>
<p>Pour <code>numpy</code> la méthode par défaut est PCG64 (cf.&nbsp;<a href="https://numpy.org/doc/stable/reference/random/bit_generators/pcg64.html">documentation de <code>numpy</code></a>), qui dispose de meilleures garanties statistiques (Voir le site <a href="https://www.pcg-random.org/statistical-tests.html#id4">https://www.pcg-random.org</a> pour cela).</p>
</section>
<section id="usage-en-numpy" class="level3">
<h3 class="anchored" data-anchor-id="usage-en-numpy">Usage en <code>numpy</code></h3>
<p>On suppose désormais disposer d’un générateur pseudo-aléatoire sur <span class="math inline">[0,1]</span>. En <code>numpy</code> depuis la version 1.17, une bonne manière d’utiliser des éléments aléatoires est d’utiliser un générateur que l’on définit soi-même:</p>
<div id="edfe8e6d" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>seed <span class="op">=</span> <span class="dv">12345</span>  <span class="co"># Toujours être conscient qu'une graine existe</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> np.random.default_rng(seed)  <span class="co">#</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rng.random())  <span class="co">##  un tirage uniforme sur [0,1]</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rng.random(size<span class="op">=</span><span class="dv">5</span>))  <span class="co">## cinq tirages uniformes sur [0,1]</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rng.random(size<span class="op">=</span>(<span class="dv">3</span>, <span class="dv">2</span>)))  <span class="co">## matrice 3x2, à entrées unif. sur [0,1]</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.22733602246716966
[0.31675834 0.79736546 0.67625467 0.39110955 0.33281393]
[[0.59830875 0.18673419]
 [0.67275604 0.94180287]
 [0.24824571 0.94888115]]</code></pre>
</div>
</div>
<p>Dans la suite on va voir comment générer d’autres lois à partir de la loi uniforme, mais il est clair que les logiciels modernes proposent un large éventail de distribution classique (gaussienne, exponentielle, etc.). Une liste exhaustive est donnée <a href="https://numpy.org/doc/stable/reference/random/generator.html#distributions">ici</a> pour <code>numpy</code>.</p>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Pour aller plus loin
</div>
</div>
<div class="callout-body-container callout-body">
<p>Une excellent discussion sur les bonnes pratiques aléatoires en <code>numpy</code>, et l’usage de <code>np.random.default_rng</code> est donnée dans ce <a href="https://albertcthomas.github.io/good-practices-random-number-generators/">blog post d’Albert Thomas</a>.</p>
</div>
</div>
</section>
<section id="propriété-de-la-loi-uniforme" class="level3">
<h3 class="anchored" data-anchor-id="propriété-de-la-loi-uniforme">Propriété de la loi uniforme</h3>
<p>On verra souvent apparaître la variable aléatoire <span class="math inline">1-U</span> où <span class="math inline">U \sim \mathcal{U}([0,1])</span>. Il se trouve que <span class="math inline">1-U</span> suit aussi une loi uniforme sur <span class="math inline">[0,1]</span> comme le montre le calcul de sa fonction de répartition. Ainsi pour tout <span class="math inline">x \in [0,1]</span> on obtient</p>
<p><span class="math display">\begin{align*}
\mathbb{P}(1-U \leq x) &amp; = \mathbb{P}(U \geq 1-x),\\
                       &amp; = 1-(1-x), \\
                       &amp; = x\,.
\end{align*}</span> On peut démontrer facilement la même relation pour <span class="math inline">x&lt;0</span> et <span class="math inline">x&gt;1</span>, d’où le résultat.</p>
</section>
</section>
<section id="méthode-dinversion" class="level2">
<h2 class="anchored" data-anchor-id="méthode-dinversion">Méthode d’inversion</h2>
<p>L’idée de la méthode d’inversion repose sur le résultat suivant :</p>
</section>
<section id="rappel-sur-la-fonction-quantile" class="level2">
<h2 class="anchored" data-anchor-id="rappel-sur-la-fonction-quantile">Rappel sur la fonction quantile</h2>
<p>Rappel : Pour <span class="math inline">F</span> une fonction définie sur <span class="math inline">\mathbb{R}</span> à valeurs dans <span class="math inline">[0, 1]</span>, croissante, on note</p>
<p><span id="eq-inf"><span class="math display">
\forall q \in ]0,1[, \quad F^\leftarrow(q) = \inf\{ x \in \mathbb{R} : F(x)\geq q\}
\tag{1}</span></span></p>
<div id="thm-quantile" class="theorem">
<p><span class="theorem-title"><strong>Théorème 1 (Caractérisation des quantiles)</strong></span> Soit <span class="math inline">F</span> une fonction définie sur <span class="math inline">\mathbb{R}</span> à valeurs dans <span class="math inline">[0, 1]</span>, croissante et continue à droite, alors pour tout <span class="math inline">q \in ]0, 1[</span>, on a</p>
<p><span class="math display">\begin{align}
   \{x \in \mathbb{R} :  F(x) \geq q) \} &amp; =
   \{x \in \mathbb{R} : x \geq F^\leftarrow(q)  \}
\end{align}</span></p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Preuve</em>. </span></p>
<ul>
<li>Cas <span class="math inline">\subset</span>: Soit <span class="math inline">x \in \mathbb{R}</span> t.q. <span class="math inline">F(x) \geq q</span>, alors par définition de l’inf dans <a href="#eq-inf" class="quarto-xref">Équation&nbsp;1</a>, <span class="math inline">x \geq F^\leftarrow(q)</span>.</li>
<li>Cas <span class="math inline">\supset</span>: Soit <span class="math inline">x \in \mathbb{R}</span> t.q. <span class="math inline">x \geq F_X^\leftarrow(q)</span> alors pour tout <span class="math inline">\epsilon &gt; 0</span>, <span class="math inline">x + \epsilon &gt; F^\leftarrow(q)</span>, donc <span class="math inline">F(x + \epsilon) \geq q</span>. Puis, par continuité à droite de <span class="math inline">F</span>, <span class="math inline">F(x) \geq q</span>.</li>
</ul>
</div>
<p><br></p>
</section>
<section id="méthode-dinversion-1" class="level2">
<h2 class="anchored" data-anchor-id="méthode-dinversion-1">Méthode d’inversion</h2>
<div id="thm-methode_inversion" class="theorem">
<p><span class="theorem-title"><strong>Théorème 2 (Méthode d’inversion)</strong></span> Soit <span class="math inline">X</span> une v.a réelle, et <span class="math inline">U \sim\mathcal{U}([0,1])</span>, alors la variable aléatoire <span class="math inline">F_X^{\leftarrow}(U)</span> a même loi que <span class="math inline">X</span>.</p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Preuve</em>. </span>En utilisant le théorème précédent, on a <span class="math inline">\mathbb{P}(F_X^{\leftarrow}(U) \leq x) = \mathbb{P}(U \leq F_X(x))</span> pour tout <span class="math inline">x\in\mathbb{R}</span>. Puis, comme <span class="math inline">U</span> est une loi uniforme sur <span class="math inline">[0,1],  \mathbb{P}(U\leq F_X(x))=F_X(x)</span>.</p>
<p>On en déduit donc que la loi de <span class="math inline">F_X^{-1}(U)</span> est la même que celle de <span class="math inline">X</span>, car les deux v.a. ont la même fonction de répartition.</p>
</div>
<p><br></p>
<div id="exm-inverse-exponentielle" class="theorem example">
<p><span class="theorem-title"><strong>Exemple 1 (Simulation d’une loi exponentielle)</strong></span> On rappelle que la loi exponentielle de paramètre <span class="math inline">\lambda &gt; 0</span> a pour densité <span class="math display">
f_{\lambda}(x) = \lambda e^{-\lambda x} {1\hspace{-3.8pt} 1}_{\mathbb{R}_+}(x)\enspace.
</span> et donc pour fonction de répartition <span class="math display">
F_{\lambda}(x) = (1 - e^{-\lambda x}) {1\hspace{-3.8pt} 1}_{\mathbb{R}_+}(x)\enspace.
</span> On vérifie que <span class="math inline">F_{\lambda}</span> est bijective de <span class="math inline">\mathbb{R}_+</span> dans <span class="math inline">]0,1[</span> et que son inverse est donnée pour tout <span class="math inline">u \in ]0,1[</span> par <span class="math display">
F_{\lambda}^{-1}(u) = -\frac{1}{\lambda} \log(1-u)\enspace.
</span></p>
</div>
<p><br></p>
<div id="exm-inverse-weibull" class="theorem example">
<p><span class="theorem-title"><strong>Exemple 2 (Simulation d’une loi de Weibull)</strong></span> La loi de Weibull de paramètre <span class="math inline">\lambda &gt; 0</span> et <span class="math inline">k &gt;0</span> est caractérisée par la fonction de répartition <span class="math display">
F(x) = (1 - e^{-(x/\lambda)^k}){1\hspace{-3.8pt} 1}_{\mathbb{R}_+}(x)
</span> C’est une loi utilisée dans différents domaines, notamment en gestion des risques (hydrologie, finance, assurance, etc.). Le calcul de l’inverse généralisée <span class="math inline">F^\leftarrow</span> est immédiat car <span class="math inline">F</span> est bijective sur <span class="math inline">]0, \infty[</span> : <span class="math display">
    F^\leftarrow (u) = \lambda (-\ln(1-u))^{\frac{1}{k}}\,, \quad u \in ]0,1[\,.
</span> La méthode d’inversion s’applique : si <span class="math inline">U \sim \mathcal{U}([0,1])</span>, alors la variable aléatoire <span class="math inline">X = \lambda (-\ln(U))^{\frac{1}{k}}</span> suit une loi de Weibull de paramètres <span class="math inline">\lambda</span> et <span class="math inline">k</span>.</p>
</div>
<p>Malheureusement, la fonction <span class="math inline">F</span> n’est pas toujours inversible (penser aux lois discrètes) c’est donc pourquoi on utilise l’inverse l’inverse généralisée ou fonction quantile introduite dans la section <a href="../Courses/notations.html">Notations</a>: <!-- @def-quantile: --></p>
<p><span class="math display">
  F^\leftarrow(p)=  \inf\{ x \in \mathbb{R} \colon F(x)\geq p\} \enspace.
</span></p>
<p><strong>Interprétation:</strong> Définir l’inverse d’une fonction de répartition <span class="math inline">F</span> revient à résoudre l’équation <span class="math inline">F(x) = \alpha</span> d’inconnue <span class="math inline">x</span> pour un <span class="math inline">\alpha</span> fixé. Si <span class="math inline">F</span> n’est pas bijective, deux problèmes apparaissent :</p>
<ul>
<li>l’équation n’a aucune solution ce qui revient à dire que <span class="math inline">F</span> n’est pas surjectif (graphiquement, <span class="math inline">F</span> présente des sauts) ;</li>
<li>l’équation a plusieurs solutions ce qui revient à dire que <span class="math inline">F</span> n’est pas injective (graphiquement cela se matérialise par un plateau à la hauteur <span class="math inline">\alpha</span>). Un exemple classique est celui où <span class="math inline">F</span> est la fonction de répartition d’une variable aléatoire discrète.</li>
</ul>
<p>Le passage à l’inéquation <span class="math inline">F(x) \geq u</span> permet de contourner la non-surjectivité : on ne regarde non plus les droites horizontales <span class="math inline">y=u</span> mais la région <span class="math inline">\{y \geq \alpha\}</span>. Le choix de l’<span class="math inline">\inf</span> dans la définition de <span class="math inline">F^{\leftarrow}</span> permet de contourner la non-injectivité : vu qu’il y a possiblement plusieurs <span class="math inline">x</span> tels que <span class="math inline">F(x) \geq u</span>, on choisit le “premier”. Ces considérations sont illustrées en Figure <a href="#fig-3-quantiles" class="quarto-xref">Figure&nbsp;2</a>.</p>
<div>

</div>
<div id="cell-fig-3-quantiles" class="cell quarto-layout-panel" data-execution_count="6" data-layout-ncol="1">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-3-quantiles" class="cell-output cell-output-display quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-3-quantiles-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<pre id="fig-3-quantiles" class="cell-output cell-output-display"><code>Unable to display output for mime type(s): application/pdf</code></pre>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-3-quantiles-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Fonction de répartition et quantiles: solution de F(x) = u
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<p><strong>Remarques additionnelles</strong>:</p>
<ul>
<li>La fonction <span class="math inline">F</span> étant croissante, la quantité <span class="math inline">F^\leftarrow(u)</span> correspond au premier instant où <span class="math inline">F</span> dépasse <span class="math inline">\alpha</span>. Si <span class="math inline">F</span> est bijective (ce qui équivaut dans ce cas à strictement croissante et injective), alors <span class="math inline">F^\leftarrow = F^{-1}</span>.</li>
<li>La fonction <span class="math inline">F^\leftarrow</span> n’est rien d’autre que la fonction quantile : si <span class="math inline">0 &lt; \alpha &lt; 1</span>, <span class="math inline">q_{1-\alpha} = F^\leftarrow(1-\alpha)</span> est le quantile d’ordre <span class="math inline">(1-\alpha)</span> de <span class="math inline">F</span>. Par exemple, <span class="math inline">F^\leftarrow(1/2)</span> correspond à la médiane.</li>
<li>Notons que si <span class="math inline">u=0</span>, on peut alors naturellement poser <span class="math inline">F^{\leftarrow}(0) = -\infty</span>. De même, avec la convention la convention <span class="math inline">\inf \emptyset = +\infty</span>, on peut alors étendre la définition de <span class="math inline">F^\leftarrow</span> à <span class="math inline">u=1</span> (mais <span class="math inline">F^\leftarrow(1)</span> n’est pas toujours égal à <span class="math inline">\infty</span>, voir les exemples ci-dessous).</li>
</ul>
<div id="exm-inverse-bernoulli" class="theorem example">
<p><span class="theorem-title"><strong>Exemple 3 (Simulation d’une loi de Bernoulli)</strong></span> La fonction de répartition <span class="math inline">F</span> d’une loi de Bernoulli de paramètre <span class="math inline">p \in ]0,1[</span> est donnée par <span class="math display">
    F(x) =
    \Bigg\{ \begin{array}{ll}
        0   &amp; \text{ si } x &lt; 0\,,        \\
        1-p &amp; \text{ si } 0 \leq x &lt; 1\,, \\
        1   &amp; \text{ si } x \leq 1\,.
    \end{array}
</span> L’inverse généralisée de <span class="math inline">F</span> peut ainsi être calculée via la formule de l’exemple : <span class="math display">
    F^\leftarrow(u) =
    \bigg\{ \begin{array}{ll}
        0 &amp; \text{ si } 0 &lt; u \leq 1-p\,, \\
        1 &amp; \text{ si } 1-p &lt; u \leq 1\,.
    \end{array}
</span> ce qui se réécrit plus simplement <span class="math inline">F^\leftarrow(u) = {1\hspace{-3.8pt} 1}_{\{1-p &lt; u\}}</span>.</p>
<p>Ainsi, si <span class="math inline">U</span> suit une loi uniforme sur <span class="math inline">[0,1]</span> alors <span class="math inline">{1\hspace{-3.8pt} 1}_{\{1-p &lt; U\}}</span> suit une loi de Bernoulli de paramètre <span class="math inline">p</span>. Comme <span class="math inline">1-U</span> suit aussi une loi uniforme sur <span class="math inline">[0,1]</span>, on en déduit que <span class="math inline">{1\hspace{-3.8pt} 1}_{\{U &lt; p\}}</span> suit une loi de Bernoulli de paramètre <span class="math inline">p</span>. Notons que l’on peut remplacer l’inégalité stricte par une inégalité large.</p>
</div>
<p><br></p>
<div id="prp-inversion_discrete" class="theorem proposition">
<p><span class="theorem-title"><strong>Proposition 1 (Loi à support fini)</strong></span> <br></p>
<p>Soit <span class="math inline">X</span> une variable aléatoire discrète prenant uniquement les valeurs <span class="math inline">x_1 &lt; \dots &lt; x_r</span> (<span class="math inline">r</span> modalité possibles) avec probabilité <span class="math inline">p_1, \dots, p_r</span> (donc <span class="math inline">p_1 + \dots + p_r=1</span>). On vérifie que pour tout <span class="math inline">u \in ]0,1[</span>, <span class="math display">
        F^\leftarrow(u) =
        \begin{cases}
            x_1 &amp; \text{si } 0 &lt; u \leq p_1\,,                  \\
            x_2 &amp; \text{si } p_1 &lt; u \leq p_1+p_2\,,            \\
                &amp; \vdots                                        \\
            x_r &amp; \text{si }  \sum_{i=1}^{r-1} p_i &lt; u &lt; 1\,.
        \end{cases}
</span></p>
<p>Sur cet exemple, on peut prolonger la définition de <span class="math inline">F^\leftarrow</span> à <span class="math inline">u=1</span> en posant <span class="math inline">F^\leftarrow(1) = x_r</span>. L’inverse généralisée se réécrit alors sous la forme <span class="math display">
        F^\leftarrow(u) = \sum_{k=1}^r x_k {1\hspace{-3.8pt} 1}_{ \{  \sum_{i=1}^{k-1}p_i &lt; u \leq \sum_{i=1}^{k}p_i \} }\enspace,
</span> où on a posé <span class="math inline">p_0=0</span>.</p>
</div>
<p>L’expression précédente s’étend directement au cas où <span class="math inline">X</span> prend un nombre (infini) dénombrable de valeurs, la somme devenant alors une série.</p>
<p>La méthode est illustré ci-dessous pour quelques lois intéressantes:</p>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb3" data-startfrom="562" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 561;"><span id="cb3-562"><a href="#cb3-562" aria-hidden="true" tabindex="-1"></a>viewof dist <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>([<span class="st">'normal'</span><span class="op">,</span><span class="st">'cauchy'</span><span class="op">,</span><span class="st">'laplace'</span><span class="op">,</span><span class="st">'bimodal'</span>]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="st">"bimodal"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Loi"</span>})</span>
<span id="cb3-563"><a href="#cb3-563" aria-hidden="true" tabindex="-1"></a>viewof replay <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;button&gt;Relancer`</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="sourceCode cell-code hidden" id="cb4" data-startfrom="583" data-source-offset="-425"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 582;"><span id="cb4-583"><a href="#cb4-583" aria-hidden="true" tabindex="-1"></a>invcdfboard <span class="op">=</span> <span class="pp">require</span>(<span class="cf">await</span> <span class="fu">FileAttachment</span>(<span class="st">"../inverse-vizu/dist/invcdfboard.umd.cjs"</span>)<span class="op">.</span><span class="fu">url</span>())</span>
<span id="cb4-584"><a href="#cb4-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-585"><a href="#cb4-585" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb4-586"><a href="#cb4-586" aria-hidden="true" tabindex="-1"></a>  replay</span>
<span id="cb4-587"><a href="#cb4-587" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> canvas <span class="op">=</span> DOM<span class="op">.</span><span class="fu">canvas</span>(<span class="dv">500</span><span class="op">,</span> <span class="dv">500</span>)<span class="op">;</span></span>
<span id="cb4-588"><a href="#cb4-588" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> galton <span class="op">=</span> invcdfboard<span class="op">.</span><span class="fu">galton</span>(canvas<span class="op">,</span>dist)<span class="op">;</span></span>
<span id="cb4-589"><a href="#cb4-589" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-590"><a href="#cb4-590" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">html</span><span class="vs">`</span><span class="sc">${</span>galton<span class="op">.</span><span class="at">canvas</span><span class="sc">}</span><span class="vs">`</span></span>
<span id="cb4-591"><a href="#cb4-591" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell quarto-layout-panel" data-layout-align="center" data-layout-ncol="1">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<div id="ojs-cell-2-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<div id="ojs-cell-2-2" data-nodetype="expression">

</div>
</div>
</div>
</div>
</section>
<section id="méthode-de-rejet" class="level2">
<h2 class="anchored" data-anchor-id="méthode-de-rejet">Méthode de rejet</h2>
<p>L’idée de la méthode de rejet est la suivante. On souhaite simuler une variable aléatoire <span class="math inline">X</span> de densité <span class="math inline">f</span>, appelée <strong>loi cible</strong>, mais <span class="math inline">f</span> est trop compliquée pour que la simulation puisse se faire directement. On dispose cependant d’une autre densité <span class="math inline">g</span> possédant les propriétés suivantes :</p>
<ul>
<li>on sait simuler <span class="math inline">Y</span> de loi <span class="math inline">g</span>,</li>
<li>il existe <span class="math inline">m &gt; 0</span> tel que <span class="math inline">f(x) \leq m \cdot g(x)</span>,</li>
<li>on sait évaluer le <strong>rapport d’acceptation</strong> <span class="math inline">r(x) = \frac{f(x)}{mg(x)}</span>.</li>
</ul>
<p>Remarquons d’ores et déjà que la constante <span class="math inline">m</span> est nécessairement plus grande que <span class="math inline">1</span> car <span class="math display">
    1 = \int_{\mathbb{R}} f(x) \, dx \leq m \int_{\mathbb{R}} g(x)\, dx = m\,.
</span></p>
<p>L’idée est alors de considérer deux suites i.i.d. de variables aléatoires indépendantes entre elles:</p>
<ul>
<li><span class="math inline">(Y_n)_{n \geq 1}</span> de loi <span class="math inline">g</span>,</li>
<li><span class="math inline">(U_n)_{n \geq 1}</span> de loi uniforme sur <span class="math inline">[0,1]</span>.</li>
</ul>
<p>En pratique, <span class="math inline">Y_n</span> correspond à une proposition et <span class="math inline">U_n</span> permettra de décider si on accepte la proposition ou non. Si oui, alors on conserve <span class="math inline">Y_n</span>, sinon on simule <span class="math inline">Y_{n+1}</span>. Le rapport d’acceptation, c’est-à-dire la proportion de <span class="math inline">Y_n</span> acceptées, correspond à <span class="math inline">r(x)</span>.</p>
<p>Autrement dit, pour simuler <span class="math inline">X</span> de densité <span class="math inline">f</span>, il suffit de simuler <span class="math inline">Y</span> de densité <span class="math inline">g</span> et <span class="math inline">U</span> uniforme jusqu’à ce que <span class="math inline">U \leq r(Y)</span>. La proposition suivante assure que cette méthode donne bien le résultat voulu.</p>
<div id="prp-rejet" class="theorem proposition">
<p><span class="theorem-title"><strong>Proposition 2 (Méthode de rejet)</strong></span> <br></p>
<p>Soit <span class="math inline">T = \inf \{n \geq 1 : U_n \leq r(Y_n)\}</span> le premier instant où le tirage est accepté. Alors :</p>
<ul>
<li><span class="math inline">T</span> suit une loi géométrique de paramètre <span class="math inline">1/m</span>,</li>
<li>la variable aléatoire <span class="math inline">X = Y_T</span> a pour densité <span class="math inline">f</span> et est indépendante de <span class="math inline">T</span>.</li>
</ul>
</div>
<div class="proof">
<p><span class="proof-title"><em>Preuve</em>. </span>Il s’agit d’étudier la loi du couple <span class="math inline">(X,T)</span>. Pour <span class="math inline">x \in \mathbb{R}</span> et <span class="math inline">n \in \mathbb{N}^{*}</span>, on écrit <span class="math inline">\mathbb{P}(X \leq x, T=n)= \mathbb{P}(U_1 &gt; r(Y_1), \dots, U_{n-1} &gt; r(Y_{n-1}), U_n \leq r(Y_n), Y_n \leq x).</span> Les <span class="math inline">n</span> tirages étant iid, on obtient <span class="math display">
    \mathbb{P}(X \leq x, T=n) = \mathbb{P}(U_1 &gt; r(Y_1))^{n-1} \mathbb{P}(U_n \leq r(Y_n), Y_n \leq x)\,.
</span></p>
<p>Concernant le premier terme, les variables aléatoires <span class="math inline">Y_1</span> et <span class="math inline">U_1</span> sont indépendantes donc leur loi jointe correspond au produit des densités : <span class="math display">\begin{align*}
        \mathbb{P}(U_1 &gt; r(Y_1))
         &amp; = \mathbb{P}((U_1, Y_1) \in \{(u,y) \in \mathbb{R}^2 : u &gt; r(y)\})                             \\
         &amp; = \int_{\mathbb{R}^2} {1\hspace{-3.8pt} 1}_{\{u &gt; r(y)\}} ({1\hspace{-3.8pt} 1}_{[0,1]}(u) g(y)) \, du dy  \\
         &amp; = \int_{\mathbb{R}} \bigg( \int_0^1 {1\hspace{-3.8pt} 1}_{\{u &gt; r(y)\}} \, du\bigg) g(y)\, d y \\
         &amp; =  \int_{\mathbb{R}} (1-r(y)) \, g(y)\, d y\,,
\end{align*}</span> ce qui se réécrit, comme <span class="math inline">f</span> et <span class="math inline">g</span> sont des densités et que <span class="math inline">r(y) = f(y)/(m \cdot g(y))</span>: <span class="math display">\begin{align*}
        \mathbb{P}(U_1 &gt; r(Y_1))
        &amp; = \int_{\mathbb{R}} g(y)\, d y - \int_{\mathbb{R}} \dfrac{f(y)}{m}\, dy \\
        &amp; = 1 - \dfrac{1}{m}\,.
\end{align*}</span> Le deuxième terme se calcule de manière analogue :</p>
<p><span class="math display">\begin{align*}
    \mathbb{P}(U_n \leq r(Y_n), Y_n \leq x)
        &amp; = \int_{\mathbb{R}^2} {1\hspace{-3.8pt} 1}_{\{u \leq r(y)\}} {1\hspace{-3.8pt} 1}_{\{y \leq x\}} ({1\hspace{-3.8pt} 1}_{[0,1]}(u) g(y)) \, du dy       \\
        &amp; = \int_{\mathbb{R}} \bigg( \int_0^1  {1\hspace{-3.8pt} 1}_{\{u \leq r(y)\}} \, du\bigg) {1\hspace{-3.8pt} 1}_{\{y \leq x\}}  g(y)\, d y\,,
\end{align*}</span> c’est-à-dire</p>
<p><span class="math display">\begin{align*}
        \mathbb{P}(U_n \leq r(Y_n), Y_n \leq x)
        &amp; = \int_{\mathbb{R}} r(y) {1\hspace{-3.8pt} 1}_{\{y \leq x\}}  g(y)\, d y \\
        &amp; = \int_{-\infty}^x \dfrac{f(y)}{m}\, d y \\
        &amp; = \dfrac{F(x)}{m}\,,
\end{align*}</span> où <span class="math inline">F</span> est la fonction de répartition de la loi de densité <span class="math inline">f</span>. On peut ainsi conclure que <span class="math display">
    \mathbb{P}(X \leq x, T=n)
    =
    \bigg(1 - \dfrac{1}{m}\bigg)^{n-1} \dfrac{F(x)}{m}\,.
</span> Il ne reste plus qu’à étudier les lois marginales. D’une part, par continuité monotone croissante, <span class="math display">
    \mathbb{P}(T=n)
    = \lim_{q \to \infty} \mathbb{P}(X \in ]-\infty, q], T=n)\,,
</span> ce qui donne</p>
<p><span class="math display">\begin{align*}
    \mathbb{P}(T=n)
    &amp; = \lim_{q \to \infty} \bigg(1 - \dfrac{1}{m}\bigg)^{n-1} \dfrac{F(q)}{m}\\
    &amp; = \bigg(1 - \dfrac{1}{m}\bigg)^{n-1} \dfrac{1}{m}\,.
\end{align*}</span> On en déduit que <span class="math inline">T</span> suit une loi géométrique de paramètre <span class="math inline">1/m</span>. D’autre part, par <span class="math inline">\sigma</span>-additivité,</p>
<p><span class="math display">\begin{align*}
    \mathbb{P}(X \leq x)
    &amp; = \mathbb{P}(X \leq x, T \in \mathbb{N}^*)\\
    &amp; = \sum_{n=1}^\infty \mathbb{P}(X \leq x, T=n)\,,
\end{align*}</span> ce qui donne</p>
<p><span class="math display">\begin{align*}
    \mathbb{P}(X \leq x)
    &amp; = \sum_{n=1}^\infty \bigg(1 - \dfrac{1}{m}\bigg)^{n-1} \dfrac{F(x)}{m}\\
    &amp; = \dfrac{1}{1-(1-1/m)} \dfrac{F(x)}{m}\\
    &amp; = F(x)\,,
\end{align*}</span> ce qui prouve que <span class="math inline">X</span> a pour loi <span class="math inline">F</span>.</p>
<p>Enfin, la loi du couple <span class="math inline">(X,T)</span> est égale au produit des lois</p>
<p><span class="math display">\begin{align*}
    \mathbb{P}(X \leq x, T=n)
    &amp; = \bigg(1 - \dfrac{1}{m}\bigg)^{n-1} \dfrac{F(x)}{m}\\
    &amp; = \mathbb{P}(T=n) \mathbb{P}(X \leq x)\,,
\end{align*}</span></p>
</div>
<div id="8293d74f" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> accept_reject(n, f, g, g_sampler, m):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">    n: nombre de simulations</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">    f: densité cible</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">    g: densité des propositions, g_sampler: simulateur selon g</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">    m: constante pour la majoration</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    x_samples <span class="op">=</span> np.zeros(n)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    u_samples <span class="op">=</span> np.zeros(n)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    accepted <span class="op">=</span> np.zeros(n)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    n_accepted <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> n_accepted <span class="op">&lt;</span> n:</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> g_sampler()</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        u <span class="op">=</span> np.random.uniform()</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>        alpha <span class="op">=</span> u <span class="op">*</span> m <span class="op">*</span> g(x)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>        u_samples [n_accepted] <span class="op">=</span> alpha</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        x_samples[n_accepted] <span class="op">=</span> x</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>  alpha <span class="op">&lt;=</span> f(x):</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>            accepted[n_accepted] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>        n_accepted <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x_samples, u_samples, accepted</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
En pratique…
</div>
</div>
<div class="callout-body-container callout-body">
<p>On simule <span class="math inline">U_1</span> et <span class="math inline">Y_1</span>. Si <span class="math inline">U_1 \leq r(Y_1)</span> c’est gagné, on pose <span class="math inline">X=Y_1</span>. Sinon, on simule <span class="math inline">U_2</span> et <span class="math inline">Y_2</span> et on teste à nouveau l’inégalité <span class="math inline">U_2 \leq r(Y_2)</span>. Et ainsi de suite. Comme <span class="math inline">T</span> suit une loi géométrique de paramètre <span class="math inline">1/m</span>, son espérance vaut <span class="math inline">m</span> : il faut en moyenne <span class="math inline">m</span> tentatives pour obtenir une simulation de la loi de densité <span class="math inline">f</span>. L’objectif est alors de choisir un couple <span class="math inline">(g, m)</span> de sorte que <span class="math inline">m</span> soit le plus proche possible de <span class="math inline">1</span>.</p>
</div>
</div>
<div id="exm-rejet_polynome" class="theorem example">
<p><span class="theorem-title"><strong>Exemple 4 (Rejet d’une loi polynomiale)</strong></span> Donnons un exemple jouet (on étudiera des exemples plus pertinents en TD). On considère la densité <span class="math inline">f(x) = 4x^3 {1\hspace{-3.8pt} 1}_{[0,1]}(x)</span>. Comme <span class="math inline">f</span> est majorée par <span class="math inline">4</span>, on peut choisir pour <span class="math inline">g</span> la densité de la loi uniforme sur <span class="math inline">[0,1]</span> et <span class="math inline">m=4</span>. Alors, <span class="math inline">r(x) =f(x) / (mg(x)) = x^3</span>, pour <span class="math inline">x \in [0,1]</span>. On simule donc <span class="math inline">(Y_1, U_1)</span> et on teste si <span class="math inline">U_1 \leq Y_1^3</span>, etc.</p>
<p>Bien évidemment, on privilégiera ici une simulation via <span class="math inline">F^\leftarrow</span> qui permet de générer des variables aléatoires de loi <span class="math inline">f</span> plus rapidement.</p>
<div id="cell-fig-rejet-polynome-unif" class="cell" data-execution_count="9">
<div id="fig-rejet-polynome-unif" class="cell-output cell-output-display quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-rejet-polynome-unif-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<pre id="fig-rejet-polynome-unif" class="cell-output cell-output-display"><code>Unable to display output for mime type(s): application/pdf</code></pre>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-rejet-polynome-unif-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Visualisation des zones d’acceptations/rejet (g uniforme)
</figcaption>
</figure>
</div>
</div>
<p>Nous pouvons facilement améliorer la proportion de point acceptés en proposant par exemple <span class="math inline">g</span> définie par <span class="math inline">g(x) = 2x {1\hspace{-3.8pt} 1}_{[0, 1]}(x)</span>, et <span class="math inline">m=2</span>.</p>
<div id="cell-fig-rejet-polynome-tri" class="cell" data-execution_count="10">
<div id="fig-rejet-polynome-tri" class="cell-output cell-output-display quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-rejet-polynome-tri-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<pre id="fig-rejet-polynome-tri" class="cell-output cell-output-display"><code>Unable to display output for mime type(s): application/pdf</code></pre>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-rejet-polynome-tri-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Visualisation des zones d’acceptations/rejet (g triangulaire)
</figcaption>
</figure>
</div>
</div>
<div id="11e98317" class="cell" data-execution_count="11">
<div class="cell-output cell-output-display">
<script type="ojs-define">{"contents": [{"name": "ratio1", "value": 0.249}]}</script>
</div>
<div class="cell-output cell-output-display">
<script type="ojs-define">{"contents": [{"name": "ratio2", "value": 0.496}]}</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb6" data-startfrom="838" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 837;"><span id="cb6-838"><a href="#cb6-838" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`Le taux d'acceptation est passé de **</span><span class="sc">${</span>ratio1<span class="sc">}</span><span class="vs">** à</span></span>
<span id="cb6-839"><a href="#cb6-839" aria-hidden="true" tabindex="-1"></a><span class="vs">**</span><span class="sc">${</span>ratio2<span class="sc">}</span><span class="vs">** en utilisant une loi triangulaire au lieu d'une loi uniforme.`</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-3" data-nodetype="expression">

</div>
</div>
</div>
</div>
<p><br></p>
<div id="exm-rejet_andrews" class="theorem example">
<p><span class="theorem-title"><strong>Exemple 5 (Rejet d’une loi de densité d’Andrews)</strong></span> Considérons la densité d’Andrews définie par <span class="math inline">f(x) = \frac{1}{S} \frac{\sin(\pi\cdot x)}{\pi \cdot x}  {1\hspace{-3.8pt} 1}_{[-1,1]}(x)</span>, avec <span class="math inline">S = \int_{-1}^{1}\frac{\sin(\pi\cdot x)}{\pi \cdot x}dx</span>. Dans ce contexte, on ne connait pas la valeur exacte de <span class="math inline">S</span>, et on va donc utiliser la méthode de rejet pour simuler des variables aléatoires de loi <span class="math inline">f</span> sans cette information. On peut l’adapter le test de la manière suivante: si l’on prend <span class="math inline">m=2/S</span> et <span class="math inline">g(x) = \frac{1}{2} {1\hspace{-3.8pt} 1}_{[-1,1]}(x)</span>, on observe que tester <span class="math inline">u\leq \frac{f(x)}{m \cdot g(x)}</span> est équivalent à tester <span class="math inline">u \leq r(x)=\frac{1}{S} \frac{\sin(\pi\cdot x)}{\pi \cdot x}  \cdot \frac{1}{\frac{2}{S} g(x)} = \frac{\sin(\pi\cdot x)}{\pi \cdot x}  \cdot \frac{1}{2 \cdot g(x)}</span>, ce qui peut se faire sans connaissance de <span class="math inline">S</span>. De plus on peut vérifier que <span class="math inline">g(x) = \frac{1}{2} {1\hspace{-3.8pt} 1}_{[-1,1]}(x)</span> définit une densité et que <span class="math inline">f(x) \leq m \cdot g(x)</span> pour tout <span class="math inline">x\in \mathbb{R}</span>.</p>
<div id="8f6f3ec5" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">10000</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> <span class="kw">lambda</span> x: np.ones_like(x) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>g_sampler <span class="op">=</span> <span class="kw">lambda</span>: <span class="dv">2</span> <span class="op">*</span> np.random.uniform() <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>x_samples, u_samples, accepted <span class="op">=</span> accept_reject(n, np.sinc, g, g_sampler, m)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>ratio <span class="op">=</span> np.<span class="bu">sum</span>(accepted) <span class="op">/</span> n</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: https://stackoverflow.com/questions/70804891/how-to-vectorize-a-function-in-python-that-includes-a-limit-e-g-sinx-x</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="94340e83" class="cell" data-execution_count="13">
<div class="cell-output cell-output-display">
<script type="ojs-define">{"contents": [{"name": "ratio", "value": 0.5955}]}</script>
</div>
</div>
<p>On peut approcher numériquement la valeur exacte de <span class="math inline">S</span> en utilisant une méthode de calcul approchée, ce qui permet de comparer ici notre méthode de rejet avec la densité sous-jacente:</p>
<div id="f784f4b1" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> integrate</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>S <span class="op">=</span> integrate.quad(np.sinc, <span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)[<span class="dv">0</span>]</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"En utilisant la méthode de rejet, on trouve que S = </span><span class="sc">{</span>S<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>En utilisant la méthode de rejet, on trouve que S = 1.179</code></pre>
</div>
</div>
<p>Enfin, on peut visualiser la qualité l’approximation de la densité par la méthode de rejet en comparant la densité approchée (avec un histogramme) avec la densité exacte:</p>
<div id="cell-fig-rejet-Andrews" class="cell" data-execution_count="15">
<div id="fig-rejet-andrews" class="cell-output cell-output-display quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-rejet-andrews-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<pre id="fig-rejet-andrews" class="cell-output cell-output-display"><code>Unable to display output for mime type(s): application/pdf</code></pre>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-rejet-andrews-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Méthode de rejet pour simuler une loi de densité de type Andrews, sans connaissance de la valeur exacte de la constante de normalisation.
</figcaption>
</figure>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb10" data-startfrom="914" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 913;"><span id="cb10-914"><a href="#cb10-914" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`Dans cet example, le taux d'acceptation est ici de **</span><span class="sc">${</span>ratio<span class="sc">}</span><span class="vs">**.`</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-4" data-nodetype="expression">

</div>
</div>
</div>
</div>
<section id="cas-mutlidimensionnel" class="level3">
<h3 class="anchored" data-anchor-id="cas-mutlidimensionnel">Cas mutlidimensionnel</h3>
<p>Commençons par un cas de dimension deux.</p>
<p>Pour cela on va utiliser la méthode de rejet pour simuler une loi de densité <span class="math inline">f</span> sur <span class="math inline">\mathbb{R}^2</span>. En particulier, un exemple classique est de tirer des points dans le disque unité, c’est-à-dire de simuler une loi uniforme sur le disque unité. Pour cela, on va utiliser la méthode de rejet avec <span class="math inline">g</span> la densité de la loi uniforme sur le carré <span class="math inline">[-1,1]^2</span>.</p>
<p>Mais prenons un autre exemple, à savoir tirer des points uniformément dans la surface délimité par une cardioïde. Pour cela, on va utiliser la méthode de rejet avec <span class="math inline">g</span> la densité de la loi uniforme sur le carré <span class="math inline">[-2,2]^2</span>.</p>
<div id="cell-fig-rejet-cercle" class="cell" data-execution_count="18">
<div id="fig-rejet-cercle" class="cell-output cell-output-display quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-rejet-cercle-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<pre id="fig-rejet-cercle" class="cell-output cell-output-display"><code>Unable to display output for mime type(s): application/pdf</code></pre>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-rejet-cercle-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Méthode de rejet pour simuler une loi uniforme sur un disque unité.
</figcaption>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Aire estimée: 3.1493333333333333</code></pre>
</div>
</div>
<div id="cell-fig-rejet-cardioide" class="cell" data-execution_count="19">
<div id="fig-rejet-cardioide" class="cell-output cell-output-display quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-rejet-cardioide-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<pre id="fig-rejet-cardioide" class="cell-output cell-output-display"><code>Unable to display output for mime type(s): application/pdf</code></pre>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-rejet-cardioide-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Méthode de rejet pour simuler une loi uniforme sur une surface délimitée par une cardioïde.
</figcaption>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Aire estimée: 4.88</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
EXERCICE loi uniforme sur un cylindre
</div>
</div>
<div class="callout-body-container callout-body">
<p>Proposer une méthode pour simuler une loi uniforme sur un cylindre de rayon <span class="math inline">1</span> et de hauteur <span class="math inline">10</span>.</p>
</div>
</div>
</section>
</section>
<section id="autres-méthodes" class="level2">
<h2 class="anchored" data-anchor-id="autres-méthodes">Autres méthodes</h2>
<section id="sommation-de-variables-aléatoires" class="level3">
<h3 class="anchored" data-anchor-id="sommation-de-variables-aléatoires">Sommation de variables aléatoires</h3>
<p>Pour simuler une variable aléatoire de loi binomiale <span class="math inline">\mathcal{B}(n,p)</span>, on peut utiliser la méthode d’inversion. Cependant, cela nécessite le calcul de l’inverse généralisée de <span class="math inline">F</span>, donc de coefficients binomiaux et de puissances de <span class="math inline">p</span> et <span class="math inline">1-p</span>. À la place, on utilisera plutôt la relation bien connue suivante : si <span class="math inline">X_1, \ldots, X_n</span> est une suite iid de variables aléatoires de loi de Bernoulli de paramètre <span class="math inline">p</span>, alors <span class="math display">
    X = X_1 + \cdots + X_n \sim \mathcal{B}(n,p)\,.
</span></p>
<p>Pour simuler des variables aléatoires de Bernoulli, on utilise la méthode d’inversion (voir Exemple ). Ainsi, si <span class="math inline">U_1, \ldots, U_n</span> sont des variables aléatoires iid de loi uniforme sur <span class="math inline">[0,1]</span>, alors <span class="math display">
    \sum_{i=1}^n {1\hspace{-3.8pt} 1}_{\{U_i \leq p\}} \sim \mathcal{B}(n,p)\,.
</span></p>
</section>
<section id="loi-de-poisson" class="level3">
<h3 class="anchored" data-anchor-id="loi-de-poisson">Loi de Poisson</h3>
<p>Rappelons qu’une variable aléatoire <span class="math inline">X</span> suit une loi de Poisson de paramètre <span class="math inline">\lambda &gt; 0</span>, notée <span class="math inline">X \sim \mathcal{P}(\lambda)</span> si <span class="math display">
    \mathbb{P}(X = k) = e^{-\lambda} \dfrac{\lambda^k}{k!}\,, \quad k \in \mathbb{N}\,.
</span> Une méthode pour simuler une variable aléatoire de loi de Poisson est donnée par la proposition suivante.</p>
<div id="prp-poisson_exponentielle" class="theorem proposition">
<p><span class="theorem-title"><strong>Proposition 3 (Génération de v.a. de loi de Poisson)</strong></span> <br></p>
<p>Soit <span class="math inline">(E_n)_{n \geq 1}</span> des variables aléatoires i.i.d. de loi exponentielle de paramètre <span class="math inline">\lambda &gt; 0</span>. On pose <span class="math inline">S_k = E_1 + \cdots + E_k</span>. Alors, pour tout <span class="math inline">n \in \mathbb{N}</span> <span class="math display">
    \mathbb{P}(S_n \leq 1 &lt; S_{n+1}) =  e^{-\lambda} \dfrac{\lambda^n}{n!}\enspace .
</span> Ainsi, la variable aléatoire <span class="math inline">T</span> définie par <span class="math display">
    T \triangleq \sup \{n \in \mathbb{N} : S_n \leq 1\}
</span> suit une loi de Poisson de paramètre <span class="math inline">\lambda</span> : <span class="math inline">T \sim \mathcal{P}(\lambda)</span>.</p>
</div>
<p>La preuve repose sur le lemme suivant.</p>
<div id="lem-erlang" class="theorem lemma">
<p><span class="theorem-title"><strong>Lemme 1 (Loi de Erlang)</strong></span> <br></p>
<p>Soit <span class="math inline">n</span> variables aléatoires <span class="math inline">E_1, \dots, E_n</span> i.i.d. de loi exponentielle de paramètre <span class="math inline">\lambda &gt;0</span>. La somme <span class="math inline">E_1+\dots+E_n</span> suit une loi d’Erlang de paramètres <span class="math inline">(n,\lambda)</span>, donnée par la fonction de répartition <span class="math display">
    F_{n,\lambda}(t) = 1 - \sum_{k=0}^{n-1} e^{-\lambda t} \frac{(\lambda t)^k}{k!}\,.
</span></p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Preuve</em>. </span>On montre le résultat pour <span class="math inline">n=2</span>. La généralisation à <span class="math inline">k</span> quelconque se fait par récurrence. Soit <span class="math inline">t &gt; 0</span>, et <span class="math inline">f_{\lambda}(x)={1\hspace{-3.8pt} 1}_{\{x \geq 0 \}} \lambda e^{-\lambda x}</span> la densité d’une loi exponentielle de paramètre <span class="math inline">\lambda</span>. Les variables aléatoires <span class="math inline">E_1</span> et <span class="math inline">E_2</span> étant indépendantes et suivant des lois exponentielles de paramètre <span class="math inline">\lambda_1</span> et <span class="math inline">\lambda_2</span>, on a</p>
<p><span class="math display">\begin{align*}
    \mathbb{P}(E_1+E_2 \leq t)
        &amp; = \int_{\mathbb{R}^2} {1\hspace{-3.8pt} 1}_{\{x_1 + x_2 \leq t\}} f_{\lambda}(x_1) f_{\lambda}(x_2)\, d x_1 d x_2 \\
        &amp; = \int_{\mathbb{R}^2} {1\hspace{-3.8pt} 1}_{\{x_1 + x_2 \leq t\}} \lambda^2 e^{-\lambda (x_1+x_2)} {1\hspace{-3.8pt} 1}_{\{x_1 \geq 0\}} {1\hspace{-3.8pt} 1}_{\{x_2 \geq 0\}}\, d x_1 d x_2 \\
        &amp; = \int_{\mathbb{R}^2} {1\hspace{-3.8pt} 1}_{\{0 \leq x_1 \leq t\}} {1\hspace{-3.8pt} 1}_{\{0 \leq x_2 \leq t-x_1\}} \lambda^2 e^{-\lambda x_1} e^{-\lambda x_2}\, d x_1 d x_2             \\
        &amp; = \int_0^t \lambda e^{-\lambda x_1} \bigg(\int _0^{t-x_1} \lambda e^{-\lambda x_2}\, d x_2\bigg)  d x_1\,.
\end{align*}</span> La première intégrale se calcule alors facilement : <span class="math display">
    \int _0^{t-x_1} \lambda e^{-\lambda x_2}\, d x_2 = 1 - e^{-\lambda(t-x_1)}\,.
</span> On obtient alors</p>
<p><span class="math display">\begin{align*}
    \mathbb{P}(E_1+E_2 \leq t)
   &amp; = \int_0^t \lambda e^{-\lambda x_1}dx_1 -  \int_0^t e^{-\lambda t} d x_1\\
   &amp; = 1 - e^{-\lambda t} - \lambda t e^{-\lambda t}\,.
\end{align*}</span> Si <span class="math inline">t&lt;0</span>, alors comme les <span class="math inline">E_i</span> ne prennent que des valeurs positives on trouve <span class="math inline">\mathbb{P}(E_1 + E_2 \leq t) = 0</span>. Ceci prouve le résultat pour <span class="math inline">n=2</span>.</p>
</div>
<p>On peut désormais prouver le résultat de la <a href="#prp-poisson_exponentielle" class="quarto-xref">Proposition&nbsp;3</a>.</p>
<div class="proof">
<p><span class="proof-title"><em>Preuve</em>. </span>Pour <span class="math inline">n \in \mathbb{N}</span>, on décompose la probabilité <span class="math inline">\mathbb{P}(S_n \leq 1 &lt; S_{n+1})</span> via</p>
<p><span class="math display">\begin{align*}
    \mathbb{P}(S_n \leq 1 &lt; S_{n+1})
    &amp; = \mathbb{P}(\{S_n \leq 1\} \setminus \{S_{n+1} \leq 1\})\\
    &amp; = \mathbb{P}(S_n \leq 1) - \mathbb{P}(S_{n+1} \leq 1)\,.
\end{align*}</span> Le lemme précédent donne <span class="math display">
    \mathbb{P}(S_n \leq 1) = 1 - \sum_{k=0}^{n-1} e^{-\lambda} \dfrac{\lambda^k}{k!}
</span> et <span class="math display">
    \mathbb{P}(S_{n+1} \leq 1) = 1 - \sum_{k=0}^{n} e^{-\lambda} \dfrac{\lambda^k}{k!}\,.
</span> On obtient alors le résultat souhaité : <span class="math display">
    \mathbb{P}(S_n \leq 1 &lt; S_{n+1})
    = e^{-\lambda} \dfrac{\lambda^n}{n!}\,.
</span></p>
<p>On conclut la preuve de la proposition en remarquant que <span class="math display">
    \mathbb{P}(T=n) = \mathbb{P}(S_n \leq 1 &lt; S_{n+1})\,.
</span></p>
</div>
<p>La simulation d’une variable aléatoire de Poisson repose donc sur la simulation de lois exponentielles qui se fait via la méthode d’inversion, comme vu dans <a href="#exm-inverse-exponentielle" class="quarto-xref">Exemple&nbsp;1</a>. En pratique, on simule <span class="math inline">E_1</span> et on teste si <span class="math inline">E_1 &gt; 1</span>. Si oui, on pose alors <span class="math inline">T=0</span>. Si non, on simule <span class="math inline">E_2</span> et on teste si <span class="math inline">E_1 + E_2 &gt; 1</span>. Si oui, on pose <span class="math inline">T=1</span>. Sinon on continue la procédure.</p>
</section>
<section id="bibliographie-et-pour-aller-plus-loin" class="level3">
<h3 class="anchored" data-anchor-id="bibliographie-et-pour-aller-plus-loin">Bibliographie et pour aller plus loin</h3>
<ul>
<li><a href="https://hal.science/hal-02427338/document">Generating Random Floating-Point Numbers by Dividing Integers: a Case Study</a> par Frédéric Goualard</li>
<li><a href="https://allendowney.com/research/rand/downey07randfloat.pdf">Generating Pseudo-random Floating-Point Values</a> par Allen Downey.</li>
</ul>


</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Retour au sommet</a></main> <!-- /main -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBkaXN0ID0gSW5wdXRzLnNlbGVjdChbJ25vcm1hbCcsJ2NhdWNoeScsJ2xhcGxhY2UnLCdiaW1vZGFsJ10sIHt2YWx1ZTogXCJiaW1vZGFsXCIsIGxhYmVsOiBcIkxvaVwifSlcbnZpZXdvZiByZXBsYXkgPSBodG1sYDxidXR0b24+UmVsYW5jZXJgXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJcbi8vIEhhY2sgdG8gbWFrZSBvanMgbG9hZCBhIGdpdGh1YiBqcyBmaWxl4oCmXG4vLyB0aGUgcmVwbyBpcyBodHRwczovL2dpdGh1Yi5jb20vZnJhZGF2L21hdHRlci1wbGF5Z3JvdW5kXG4vLyBpbnZjZGZib2FyZCA9IHtcbi8vICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9mcmFkYXYvbWF0dGVyLXBsYXlncm91bmQvbWFpbi9kaXN0L2ludmNkZmJvYXJkLnVtZC5janNcIik7XG4vLyAgIGNvbnN0IGJsb2IgPSBhd2FpdCByZXNwb25zZS5ibG9iKCk7XG4vLyAgIGNvbnN0IHVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XG4vLyAgIHJldHVybiByZXF1aXJlKHVybCkuY2F0Y2goKCkgPT4gd2luZG93LmludmNkZmJvYXJkKTtcbi8vIH1cblxuLy8gT3IgbG9hZCBmcm9tIGxvY2FsIGZpbGVcbmludmNkZmJvYXJkID0gcmVxdWlyZShhd2FpdCBGaWxlQXR0YWNobWVudChcIi4uL2ludmVyc2Utdml6dS9kaXN0L2ludmNkZmJvYXJkLnVtZC5janNcIikudXJsKCkpXG5cbntcbiAgcmVwbGF5XG4gIGNvbnN0IGNhbnZhcyA9IERPTS5jYW52YXMoNTAwLCA1MDApO1xuICBjb25zdCBnYWx0b24gPSBpbnZjZGZib2FyZC5nYWx0b24oY2FudmFzLGRpc3QpO1xuICBcbiAgcmV0dXJuIGh0bWxgJHtnYWx0b24uY2FudmFzfWBcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Im1kYExlIHRhdXggZCdhY2NlcHRhdGlvbiBlc3QgcGFzc8OpIGRlICoqJHtyYXRpbzF9Kiogw6BcbioqJHtyYXRpbzJ9KiogZW4gdXRpbGlzYW50IHVuZSBsb2kgdHJpYW5ndWxhaXJlIGF1IGxpZXUgZCd1bmUgbG9pIHVuaWZvcm1lLmBcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Im1kYERhbnMgY2V0IGV4YW1wbGUsIGxlIHRhdXggZCdhY2NlcHRhdGlvbiBlc3QgaWNpIGRlICoqJHtyYXRpb30qKi5gXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2Rpc3QnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgncmVwbGF5JykifV19
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../Courses";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copié");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copié");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../Courses/th_asymptotique.html" class="pagination-link" aria-label="Théorèmes asymptotiques">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Théorèmes asymptotiques</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../Courses/loi_normale1D.html" class="pagination-link" aria-label="Loi normale: cas univarié">
        <span class="nav-page-text">Loi normale: cas univarié</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/josephsalmon/HAX603X/blob/main/Courses/simulation.qmd" class="toc-action"><i class="bi bi-github"></i>Voir la source</a></li><li><a href="https://github.com/josephsalmon/HAX603X/issues/new" class="toc-action"><i class="bi empty"></i>Faire part d'un problème</a></li></ul></div></div></div></footer></body></html>